



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="" href="https://monkeyhh.top/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="" href="https://monkeyhh.top/atom.xml" />
<link rel="alternate" type="application/json" title="" href="https://monkeyhh.top/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="JavaScript" />


<link rel="canonical" href="https://monkeyhh.top/FrontEnd/JavaScript/FrontEnd/JavaScript/%E3%80%90%E6%89%8B%E6%92%95JavaScript%E7%B3%BB%E5%88%97%E3%80%91Promise%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAPromise">



  <title>
ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘Promiseä»‹ç»ä»¥åŠå®ç°ä¸€ä¸ªPromise - JavaScript - FrontEnd |
Monkey's Blog = </title>
<meta name="generator" content="Hexo 5.4.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘Promiseä»‹ç»ä»¥åŠå®ç°ä¸€ä¸ªPromise
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2021-07-18 12:28:20">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2021-07-18T12:28:20+08:00">2021-07-18</time>
  </span>
  <span class="item" title="Symbols count in article">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">Symbols count in article</span>
    <span>31k</span>
    <span class="text">words</span>
  </span>
  <span class="item" title="Reading time">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">Reading time</span>
    <span>28 mins.</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Monkey's Blog</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
          <img src="https://gitee.com/monkey-HH/picBed/raw/master/picbed/img/202109201019726.png">
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span><i class="ic i-angle-right"></i>
<span  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/FrontEnd/" itemprop="item" rel="index" title="In FrontEnd"><span itemprop="name">FrontEnd</span></a>
<meta itemprop="position" content="1" /></span>
<i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/FrontEnd/JavaScript/" itemprop="item" rel="index" title="In JavaScript"><span itemprop="name">JavaScript</span></a>
<meta itemprop="position" content="2" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="https://monkeyhh.top/FrontEnd/JavaScript/FrontEnd/JavaScript/%E3%80%90%E6%89%8B%E6%92%95JavaScript%E7%B3%BB%E5%88%97%E3%80%91Promise%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAPromise">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="Monkey-HH">
    <meta itemprop="description" content=", Learn, share, make progress">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="1-Promiseæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-Promiseæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.Promiseæ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.Promiseæ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæ¯”ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆâ€”â€”å›è°ƒå‡½æ•°å’Œäº‹ä»¶â€”â€”æ›´åˆç†å’Œæ›´å¼ºå¤§ã€‚å®ƒç”±ç¤¾åŒºæœ€æ—©æå‡ºå’Œå®ç°ï¼ŒES6 å°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ï¼ŒåŸç”Ÿæä¾›äº†<code>Promise</code>å¯¹è±¡ã€‚</p>
<p>æ‰€è°“<code>Promise</code>ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚</p>
<h1 id="2-Promiseçš„ç‰¹ç‚¹"><a href="#2-Promiseçš„ç‰¹ç‚¹" class="headerlink" title="2. Promiseçš„ç‰¹ç‚¹"></a>2. Promiseçš„ç‰¹ç‚¹</h1><ul>
<li>Promiseåªæœ‰ä¸‰ä¸ªçŠ¶æ€ï¼Œå¾…å®šï¼ˆpendingã€å…‘ç°ï¼ˆfulfilledï¼Œæœ‰æ—¶å€™ä¹Ÿç§°ä¸ºâ€œè§£å†³â€ï¼Œresolvedï¼‰ã€æ‹’ç»ï¼ˆrejectedï¼‰ã€‚</li>
<li>å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ï¼Œä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ã€‚<code>Promise</code>å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ã€<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰å’Œ<code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚</li>
</ul>
<p><img data-src="https://gitee.com/monkey-HH/picBed/raw/master/picbed/img/202111161823888.png" alt="image-20211116182323801"></p>
<p>ç¼ºç‚¹:</p>
<p> (1)æ— æ³•å–æ¶ˆPromiseï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚å’Œä¸€èˆ¬çš„å¯¹è±¡ä¸ä¸€æ ·ï¼Œæ— éœ€è°ƒç”¨ã€‚</p>
<p> (2)å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒPromiseå†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚</p>
<p> (3)å½“å¤„äºPendingçŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰</p>
<h1 id="3-ä¸€ä¸ªå°ç¤ºä¾‹"><a href="#3-ä¸€ä¸ªå°ç¤ºä¾‹" class="headerlink" title="3. ä¸€ä¸ªå°ç¤ºä¾‹"></a>3. ä¸€ä¸ªå°ç¤ºä¾‹</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡new	åˆ›å»ºäº†ä¸€ä¸ªPromiseå®ä¾‹ï¼Œæ­¤æ—¶Promiseçš„çŠ¶æ€ä¸ºpending</span></span><br><span class="line"><span class="keyword">let</span> promiseInstance = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="comment">/* å¼‚æ­¥æ“ä½œæˆåŠŸ */</span>)&#123;</span><br><span class="line">        resolve(value);<span class="comment">//å°†Promiseçš„çŠ¶æ€ä» pending å˜ä¸º resolvedï¼Œvalueä¸ºåŸå› </span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//å†™æ³•ä¸€ï¼š                          </span></span><br><span class="line">        reject(error);<span class="comment">//å°†Promiseçš„çŠ¶æ€ä» pending å˜ä¸º rejectedï¼Œerrorä¸ºé”™è¯¯åŸå› </span></span><br><span class="line">	    <span class="comment">//å†™æ³•äºŒï¼š</span></span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;test&#x27;</span>);<span class="comment">//ç­‰ä»·äºreject(new Error(&#x27;test&#x27;));</span></span><br><span class="line">      &#125;</span><br><span class="line">&#125;);</span><br><span class="line">promiseInstance.then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æˆåŠŸåçš„å›è°ƒå‡½æ•°æ“ä½œ</span></span><br><span class="line">&#125;);</span><br><span class="line">promiseInstance.catch(<span class="function">(<span class="params">error</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// å¤±è´¥åçš„å›è°ƒå‡½æ•°æ“ä½œ</span></span><br><span class="line">&#125;);</span><br><span class="line">promiseInstance.finally(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// ä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œ	</span></span><br><span class="line">  <span class="comment">//æ— å‚æ•°ï¼Œæ— æ³•è·å–çŠ¶æ€ï¼Œå³æœ€åæ“ä½œåº”ä¸çŠ¶æ€æ— å…³</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥é€‰æ‹©å°†ä¼ ç»™ catch çš„å‡½æ•°ä½œä¸º then æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œåªæ˜¯å†™æ³•ä¸åŒã€‚å¦‚ä¸‹</span></span><br><span class="line">promiseInstance.then(<span class="function">(<span class="params">response</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// æˆåŠŸåï¼Œfulfill çš„æ“ä½œ</span></span><br><span class="line">&#125;,<span class="function">(<span class="params">error</span>)=&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// å¤±è´¥å</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>







<h1 id="4-Promiseå¸¸ç”¨API"><a href="#4-Promiseå¸¸ç”¨API" class="headerlink" title="4.Promiseå¸¸ç”¨API"></a>4.Promiseå¸¸ç”¨API</h1><h3 id="1-Promise-æ„é€ å‡½æ•°-Promise-executor"><a href="#1-Promise-æ„é€ å‡½æ•°-Promise-executor" class="headerlink" title="1. Promise æ„é€ å‡½æ•°: Promise (executor) {}"></a>1. Promise æ„é€ å‡½æ•°: Promise (executor) {}</h3><p>(1) executor å‡½æ•°: æ‰§è¡Œå™¨ (resolve, reject) =&gt; {}</p>
<p>(2) resolve å‡½æ•°: å†…éƒ¨å®šä¹‰æˆåŠŸæ—¶æˆ‘ä»¬è°ƒç”¨çš„å‡½æ•° value =&gt; {}</p>
<p>(3) reject å‡½æ•°: å†…éƒ¨å®šä¹‰å¤±è´¥æ—¶æˆ‘ä»¬è°ƒç”¨çš„å‡½æ•° reason =&gt; {}</p>
<p>â­è¯´æ˜: executor ä¼šåœ¨ Promise å†…éƒ¨ç«‹å³<code>åŒæ­¥è°ƒç”¨</code>ï¼Œå¼‚æ­¥æ“ä½œåœ¨æ‰§è¡Œå™¨ä¸­æ‰§è¡Œ,æ¢è¯è¯´Promiseæ”¯æŒåŒæ­¥ä¹Ÿæ”¯æŒå¼‚æ­¥æ“ä½œ</p>
<h3 id="2-Promise-prototype-then-æ–¹æ³•-onResolved-onRejected-gt"><a href="#2-Promise-prototype-then-æ–¹æ³•-onResolved-onRejected-gt" class="headerlink" title="2. Promise.prototype.then æ–¹æ³•: (onResolved, onRejected) =&gt; {}"></a>2. Promise.prototype.then æ–¹æ³•: (onResolved, onRejected) =&gt; {}</h3><p>(1) onResolved å‡½æ•°: æˆåŠŸçš„å›è°ƒå‡½æ•° (value) =&gt; {}</p>
<p>(2) onRejected å‡½æ•°: å¤±è´¥çš„å›è°ƒå‡½æ•° (reason) =&gt; {}</p>
<p>è¯´æ˜: æŒ‡å®šç”¨äºå¾—åˆ°æˆåŠŸ value çš„æˆåŠŸå›è°ƒå’Œç”¨äºå¾—åˆ°å¤±è´¥ reason çš„å¤±è´¥å›è°ƒï¼Œ <strong>å¹¶ä¸”è¿”å›ä¸€ä¸ªæ–°çš„ promise å¯¹è±¡</strong></p>
<p>promise.then()è¿”å›çš„æ–° promise çš„ç»“æœçŠ¶æ€æœ‰ä¸‰ç§æƒ…å†µï¼š</p>
<p>  â‘  å¦‚æœæŠ›å‡ºå¼‚å¸¸, æ–° promise å˜ä¸º rejected, reason ä¸ºæŠ›å‡ºçš„å¼‚å¸¸</p>
<p> â‘¡ å¦‚æœè¿”å›çš„æ˜¯é promise çš„ä»»æ„å€¼, æ–° promise å˜ä¸º resolved, value ä¸ºè¿”å›çš„å€¼</p>
<p> â‘¢ å¦‚æœè¿”å›çš„æ˜¯å¦ä¸€ä¸ªæ–° promise, æ­¤ promise çš„ç»“æœå°±ä¼šæˆä¸ºæ–° promise çš„ç»“æœ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">	resolve(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//æ‰§è¡Œ then æ–¹æ³•</span></span><br><span class="line"><span class="keyword">let</span> result = p.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(value);</span><br><span class="line">	<span class="comment">// 1. æŠ›å‡ºé”™è¯¯ ,å˜ä¸º rejected</span></span><br><span class="line">	<span class="keyword">throw</span> <span class="string">&#x27;å‡ºäº†é—®é¢˜&#x27;</span>;</span><br><span class="line">	<span class="comment">// 2. è¿”å›ç»“æœæ˜¯é Promise ç±»å‹çš„å¯¹è±¡,æ–° promise å˜ä¸º resolved</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">521</span>;</span><br><span class="line">	<span class="comment">// 3. è¿”å›ç»“æœæ˜¯ Promise å¯¹è±¡,æ­¤ promise çš„ç»“æœå°±ä¼šæˆä¸ºæ–° promise çš„ç»“æœ</span></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">// resolve(&#x27;success&#x27;);</span></span><br><span class="line">		reject(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.warn(reason);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="3-Promise-prototype-catch-æ–¹æ³•ï¼š-onRejected-gt"><a href="#3-Promise-prototype-catch-æ–¹æ³•ï¼š-onRejected-gt" class="headerlink" title="3.Promise.prototype.catch()æ–¹æ³•ï¼š (onRejected) =&gt; {}"></a>3.Promise.prototype.catch()æ–¹æ³•ï¼š (onRejected) =&gt; {}</h3><p>(1) onRejected å‡½æ•°: å¤±è´¥çš„å›è°ƒå‡½æ•° (reason) =&gt; {}</p>
<p>è¯´æ˜: then()çš„è¯­æ³•ç³–, ç›¸å½“äº: then(undefined, onRejected)</p>
<p>(2) å¼‚å¸¸ç©¿é€ä½¿ç”¨:å½“è¿è¡Œåˆ°æœ€å,æ²¡è¢«å¤„ç†çš„æ‰€æœ‰å¼‚å¸¸é”™è¯¯éƒ½ä¼šè¿›å…¥è¿™ä¸ªæ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸­</p>
<p><code>Promise.prototype.catch()</code>æ–¹æ³•æ˜¯<code>.then(null, rejection)</code>æˆ–<code>.then(undefined, rejection)</code>çš„åˆ«åï¼Œç”¨äºæŒ‡å®š<strong>å‘ç”Ÿé”™è¯¯æ—¶</strong>çš„å›è°ƒå‡½æ•°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p.then(<span class="function">(<span class="params">val</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;fulfilled:&#x27;</span>, val))</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;rejected&#x27;</span>, err));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line">p.then(<span class="function">(<span class="params">val</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;fulfilled:&#x27;</span>, val))</span><br><span class="line">  .then(<span class="literal">null</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;rejected:&quot;</span>, err));</span><br></pre></td></tr></table></figure>

<p>åœ¨promiseé“¾å¼è°ƒç”¨ä¸­ï¼Œé”™è¯¯å…·æœ‰å†’æ³¡æ€§ï¼Œæˆ–è€…è¯´<code>å¼‚å¸¸ç©¿é€</code>ï¼Œ</p>
<h3 id="4-Promise-prototype-finally"><a href="#4-Promise-prototype-finally" class="headerlink" title="4. Promise.prototype.finally()"></a>4. Promise.prototype.finally()</h3><p><code>**finally()**</code> æ–¹æ³•è¿”å›ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a>ã€‚åœ¨promiseç»“æŸæ—¶ï¼Œæ— è®ºç»“æœæ˜¯fulfilledæˆ–è€…æ˜¯rejectedï¼Œéƒ½ä¼šæ‰§è¡ŒæŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚è¿™ä¸ºåœ¨<code>Promise</code>æ˜¯å¦æˆåŠŸå®Œæˆåéƒ½éœ€è¦æ‰§è¡Œçš„ä»£ç æä¾›äº†ä¸€ç§æ–¹å¼ã€‚</p>
<p>è¿™é¿å…äº†åŒæ ·çš„è¯­å¥éœ€è¦åœ¨<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/then"><code>then()</code></a>å’Œ<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch"><code>catch()</code></a>ä¸­å„å†™ä¸€æ¬¡çš„æƒ…å†µã€‚</p>
<h3 id="5-Promise-resolve-value-è¯¦è§£"><a href="#5-Promise-resolve-value-è¯¦è§£" class="headerlink" title="5.Promise.resolve(value)è¯¦è§£"></a>5.Promise.resolve(value)è¯¦è§£</h3><p>è¯´æ˜: è¿”å›ä¸€ä¸ªæˆåŠŸ/å¤±è´¥çš„ promise å¯¹è±¡,ç›´æ¥æ”¹å˜promiseçŠ¶æ€</p>
<p>ä»¥ä¸‹å†™æ³•ç­‰ä»·</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> resolve()); </span><br><span class="line"><span class="keyword">let</span> p2 = <span class="built_in">Promise</span>.resolve();</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éƒ½çŸ¥é“å…¶å¯ä»¥ä¼ å…¥ä¸€ä¸ªvalueå‚æ•°ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªä¾‹å­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.ä¼ å…¥å‚æ•°ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Promise</span>.resolve(<span class="string">&quot;3&quot;</span>)) <span class="comment">//PromiseÂ &#123;&lt;fulfilled&gt;: &quot;3&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.ä¼ å…¥å‚æ•°ä¸ºä¸€ä¸ªæ•°å­—</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Promise</span>.resolve(<span class="number">123</span>)) <span class="comment">//PromiseÂ &#123;&lt;fulfilled&gt;: 123&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.ä¼ å…¥å‚æ•°ä¸ºä¸€ä¸ªPromiseå®ä¾‹ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> promise = <span class="built_in">Promise</span>.resolve(<span class="number">7</span>)</span><br><span class="line"><span class="built_in">console</span>.log(promise == <span class="built_in">Promise</span>.resolve(promise)) <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.å‚æ•°æ˜¯ä¸€ä¸ªthenableçš„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> thenable = &#123;</span><br><span class="line">	<span class="attr">then</span>: <span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">		resolve(<span class="string">&quot;thenable&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p1 = <span class="built_in">Promise</span>.resolve(thenable);</span><br><span class="line"><span class="built_in">console</span>.log(p1) <span class="comment">//PromiseÂ &#123;&lt;pending&gt;&#125;</span></span><br><span class="line">p1.then(<span class="function"><span class="params">value</span> =&gt;</span></span><br><span class="line">	<span class="built_in">console</span>.log(p1, value) <span class="comment">// PromiseÂ &#123;&lt;fulfilled&gt;: &quot;thenable&quot;&#125; &quot;thenable&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>





<h3 id="6-Promise-reject-reason-è¯¦è§£"><a href="#6-Promise-reject-reason-è¯¦è§£" class="headerlink" title="6.Promise.reject(reason)è¯¦è§£"></a>6.Promise.reject(reason)è¯¦è§£</h3><p><strong><code>Promise.reject(reason)</code>æ–¹æ³•ä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼Œè¯¥å®ä¾‹çš„çŠ¶æ€ä¸º<code>rejected</code>ã€‚</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.reject(<span class="string">&#x27;å‡ºé”™äº†&#x27;</span>);</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> reject(<span class="string">&#x27;å‡ºé”™äº†&#x27;</span>))</span><br><span class="line"></span><br><span class="line">p.then(<span class="literal">null</span>, <span class="function"><span class="keyword">function</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(s)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// å‡ºé”™äº†</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ç”Ÿæˆä¸€ä¸ª Promise å¯¹è±¡çš„å®ä¾‹<code>p</code>ï¼ŒçŠ¶æ€ä¸º<code>rejected</code>ï¼Œå›è°ƒå‡½æ•°ä¼šç«‹å³æ‰§è¡Œã€‚</p>
<p><code>Promise.reject()</code>æ–¹æ³•çš„å‚æ•°ï¼Œä¼šåŸå°ä¸åŠ¨åœ°ä½œä¸º<code>reject</code>çš„ç†ç”±ï¼Œå˜æˆåç»­æ–¹æ³•çš„å‚æ•°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.reject(<span class="string">&#x27;å‡ºé”™äº†&#x27;</span>)</span><br><span class="line">.catch(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e === <span class="string">&#x27;å‡ºé”™äº†&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>Promise.reject()</code>æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåé¢<code>catch()</code>æ–¹æ³•çš„å‚æ•°<code>e</code>å°±æ˜¯è¿™ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<h3 id="7-Promise-all"><a href="#7-Promise-all" class="headerlink" title="7.Promise.all()"></a>7.Promise.all()</h3><p><code>Promise.all()</code>æ–¹æ³•ç”¨äºå°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const p = Promise.all([p1, p2, p3]);</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>Promise.all()</code>æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œ<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>éƒ½æ˜¯ Promise å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šå…ˆè°ƒç”¨ä¸‹é¢è®²åˆ°çš„<code>Promise.resolve</code>æ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º Promise å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚å¦å¤–ï¼Œ<code>Promise.all()</code>æ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Promise å®ä¾‹ã€‚</p>
<p><code>p</code>çš„çŠ¶æ€ç”±<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>å†³å®šï¼Œåˆ†æˆä¸¤ç§æƒ…å†µã€‚</p>
<p>ï¼ˆ1ï¼‰åªæœ‰<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„çŠ¶æ€éƒ½å˜æˆ<code>fulfilled</code>ï¼Œ<code>p</code>çš„çŠ¶æ€æ‰ä¼šå˜æˆ<code>fulfilled</code>ï¼Œæ­¤æ—¶<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p>
<p>ï¼ˆ2ï¼‰åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«<code>rejected</code>ï¼Œ<code>p</code>çš„çŠ¶æ€å°±å˜æˆ<code>rejected</code>ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«<code>reject</code>çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p>
<h3 id="8-Promise-race"><a href="#8-Promise-race" class="headerlink" title="8.Promise.race()"></a>8.Promise.race()</h3><p>å’ŒPromise.all()ä¸åŒä¹‹å¤„ä¸ºï¼Œåªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œ<code>p</code>çš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p>
<h3 id="9-Promise-allSettled"><a href="#9-Promise-allSettled" class="headerlink" title="9.Promise.allSettled()"></a>9.Promise.allSettled()</h3><p>ç­‰åˆ°ä¸€ç»„å¼‚æ­¥æ“ä½œéƒ½ç»“æŸäº†ï¼Œä¸ç®¡æ¯ä¸€ä¸ªæ“ä½œæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œå†è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resolved = <span class="built_in">Promise</span>.resolve(<span class="number">42</span>);</span><br><span class="line"><span class="keyword">const</span> rejected = <span class="built_in">Promise</span>.reject(-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> allSettledPromise = <span class="built_in">Promise</span>.allSettled([resolved, rejected]);</span><br><span class="line"></span><br><span class="line">allSettledPromise.then(<span class="function"><span class="keyword">function</span> (<span class="params">results</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(results);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// [</span></span><br><span class="line"><span class="comment">//    &#123; status: &#x27;fulfilled&#x27;, value: 42 &#125;,</span></span><br><span class="line"><span class="comment">//    &#123; status: &#x27;rejected&#x27;, reason: -1 &#125;</span></span><br><span class="line"><span class="comment">// ]</span></span><br></pre></td></tr></table></figure>

<h3 id="10-Promise-any"><a href="#10-Promise-any" class="headerlink" title="10.Promise.any()"></a>10.Promise.any()</h3><p>åªè¦å‚æ•°å®ä¾‹æœ‰ä¸€ä¸ªå˜æˆ<code>fulfilled</code>çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ<code>fulfilled</code>çŠ¶æ€ï¼›å¦‚æœæ‰€æœ‰å‚æ•°å®ä¾‹éƒ½å˜æˆ<code>rejected</code>çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ<code>rejected</code>çŠ¶æ€ã€‚</p>
<p><code>Promise.any()</code>è·Ÿ<code>Promise.race()</code>æ–¹æ³•å¾ˆåƒï¼Œåªæœ‰ä¸€ç‚¹ä¸åŒï¼Œå°±æ˜¯<code>Promise.any()</code>ä¸ä¼šå› ä¸ºæŸä¸ª Promise å˜æˆ<code>rejected</code>çŠ¶æ€è€Œç»“æŸï¼Œå¿…é¡»ç­‰åˆ°æ‰€æœ‰å‚æ•° Promise å˜æˆ<code>rejected</code>çŠ¶æ€æ‰ä¼šç»“æŸã€‚</p>
<h1 id="5-æ‰‹æ’•Promiseç³»åˆ—"><a href="#5-æ‰‹æ’•Promiseç³»åˆ—" class="headerlink" title="5. æ‰‹æ’•Promiseç³»åˆ—"></a>5. æ‰‹æ’•Promiseç³»åˆ—</h1><h2 id="5-1-é¢„å¤‡çŸ¥è¯†"><a href="#5-1-é¢„å¤‡çŸ¥è¯†" class="headerlink" title="5.1 é¢„å¤‡çŸ¥è¯†"></a>5.1 é¢„å¤‡çŸ¥è¯†</h2><ul>
<li>PromiseåŸºç¡€çŸ¥è¯†ï¼Œå¯ä»¥çœ‹çœ‹é˜®ä¸€å³°çš„es6ä¹¦ç±</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9wcm9taXNlc2FwbHVzLmNvbS8=">Promise A+è§„èŒƒ</span> ï¼ŒPromise æ˜¯åŸºäº Promise A+ è§„èŒƒå®ç°çš„ï¼Œä½¿ç”¨<span class="exturl" data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcHJvbWlzZXMtYXBsdXMtdGVzdHM=">promises-aplus-tests</span> æ£€æµ‹æˆ‘ä»¬çš„Promiseæ˜¯å¦ç¬¦åˆè§„èŒƒã€‚</li>
<li>JavaScriptè¯­æ³•çŸ¥è¯†ï¼Œä»¥ä¸‹å°†ä¼šä»¥classçš„å†™æ³•æ¥å†™ã€‚å…ˆå†™ä¸€ç‚¹å¯èƒ½ä¼šå¿˜è®°es6çš„classçš„çŸ¥è¯†</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">		<span class="comment">// æ·»åŠ åˆ° this çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šå­˜åœ¨äºä¸åŒçš„å®ä¾‹ä¸Šï¼Œå³functionInstance.method = ...</span></span><br><span class="line">		<span class="built_in">this</span>.locate = <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;instance&#x27;</span>, <span class="built_in">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å®šä¹‰åœ¨ç±»çš„åŸå‹å¯¹è±¡ä¸Šï¼Œå³åŸå‹æ–¹æ³•FunctionName.prototypre.method = ...</span></span><br><span class="line">	<span class="function"><span class="title">locate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&#x27;prototype&#x27;</span>, <span class="built_in">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å®šä¹‰åœ¨ç±»æœ¬èº«ä¸Šï¼Œå³FunctionName.method = ...</span></span><br><span class="line">	<span class="keyword">static</span> <span class="function"><span class="title">locate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&#x27;class&#x27;</span>, <span class="built_in">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> Person();</span><br><span class="line">p.locate(); <span class="comment">// instance, Person &#123;&#125; </span></span><br><span class="line">Person.prototype.locate(); <span class="comment">// prototype, &#123;constructor: ... &#125; </span></span><br><span class="line">Person.locate(); <span class="comment">// class, class Person &#123;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¾ˆå¤šæ‰‹å†™ç‰ˆæœ¬éƒ½æ˜¯ä½¿ç”¨ setTimeout å»åšå¼‚æ­¥å¤„ç†ï¼Œä½†æ˜¯ setTimeout å±äºå®ä»»åŠ¡ï¼Œè¿™ä¸ Promise æ˜¯ä¸ªå¾®ä»»åŠ¡ç›¸çŸ›ç›¾ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—é€‰æ‹©ä¸€ç§åˆ›å»ºå¾®ä»»åŠ¡çš„æ–¹å¼å»å®ç°æˆ‘ä»¬çš„æ‰‹å†™ä»£ç ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬æœ‰å‡ ç§é€‰æ‹©ï¼Œä¸€ç§å°±æ˜¯ Promise A+ è§„èŒƒä¸­ä¹Ÿæåˆ°çš„ï¼Œprocess.nextTickï¼ˆ Node ç«¯ ï¼‰ ä¸MutationObserverï¼ˆ æµè§ˆå™¨ç«¯ ï¼‰ï¼Œè€ƒè™‘åˆ°åˆ©ç”¨è¿™ä¸¤ç§æ–¹å¼éœ€è¦åšç¯å¢ƒåˆ¤æ–­ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬å°±æ¨èå¦å¤–ä¸€ç§åˆ›å»ºå¾®ä»»åŠ¡çš„æ–¹å¼ <code>queueMicrotask</code>ï¼Œäº†è§£æ›´å¤š â€“&gt; <span class="exturl" data-url="aHR0cHM6Ly9saW5rLmp1ZWppbi5jbi8/dGFyZ2V0PWh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL3poLUNOL2RvY3MvV2ViL0FQSS9IVE1MX0RPTV9BUEkvTWljcm90YXNrX2d1aWRl">åœ¨ JavaScript ä¸­é€šè¿‡ queueMicrotask() ä½¿ç”¨å¾®ä»»åŠ¡</span>;</p>
<h2 id="5-2-æ‰‹æ’•Promise"><a href="#5-2-æ‰‹æ’•Promise" class="headerlink" title="5.2 æ‰‹æ’•Promise"></a>5.2 æ‰‹æ’•Promise</h2><h3 id="5-2-1-ç¬¬ä¸€ç‰ˆï¼šç®€å•æ¡†æ¶"><a href="#5-2-1-ç¬¬ä¸€ç‰ˆï¼šç®€å•æ¡†æ¶" class="headerlink" title="5.2.1 ç¬¬ä¸€ç‰ˆï¼šç®€å•æ¡†æ¶"></a>5.2.1 ç¬¬ä¸€ç‰ˆï¼šç®€å•æ¡†æ¶</h3><p>ç¬¬ä¸€ç‰ˆè¦æ±‚ï¼š</p>
<ul>
<li>å®ç°Promiseçš„æ„é€ å‡½æ•°ï¼Œè¯¥æ„é€ å‡½æ•°èƒ½ä¼ å…¥ä¸€ä¸ªexecutorå‡½æ•°(æœ‰ä¸¤ä¸ªå‡½æ•°å‚æ•°ï¼Œresolveå’Œreject)ï¼Œå¹¶ä¸”æ˜¯åŒæ­¥è°ƒç”¨çš„ã€‚</li>
<li>Promiseå­˜åœ¨ä¸‰ä¸ªçŠ¶æ€ï¼ˆstateï¼‰pendingã€fulfilledã€rejectedï¼Œèƒ½è¿›è¡ŒçŠ¶æ€åˆ‡æ¢ï¼Œä¸”çŠ¶æ€å”¯ä¸€ï¼Œæ”¹å˜åä¸å¯å†å˜ã€‚</li>
<li>å®ç°ç®€å•çš„thenæ–¹æ³•ï¼Œ<u>ä¸è¦æ±‚èƒ½å¤„ç†setTimeoutç­‰å¼‚æ­¥ä»»åŠ¡ã€‚</u></li>
<li>å¦‚æœexecutoré‡ŒæŠ¥é”™äº†ï¼Œå°±è°ƒç”¨rejectå‡½æ•°ï¼Œå¹¶ä¼ å…¥é”™è¯¯ä»£ç ã€‚</li>
</ul>
<p><code>è§£å†³æ–¹æ¡ˆ</code>ï¼š</p>
<ul>
<li><strong>å¢</strong>ï¼šæ–°å»ºç±»ï¼ŒåŒ…å«ä¸€ä¸ªPromiseå¯¹è±¡åŸºæœ¬å±æ€§</li>
<li><strong>å¢</strong>ï¼šç”¨try-catchæ•è·ERRORï¼Œå°±è°ƒç”¨rejectå‡½æ•°</li>
<li><strong>å¢</strong>ï¼šå®ç°ç®€å•çš„thenæ–¹æ³•</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆå®šä¹‰ä¸‰ä¸ªå¸¸é‡è¡¨ç¤ºçŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> PENDING = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å»º MyPromise ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å‚¨å­˜çŠ¶æ€çš„å˜é‡ï¼Œåˆå§‹å€¼æ˜¯ pending</span></span><br><span class="line">		<span class="built_in">this</span>.status = PENDING;</span><br><span class="line">		<span class="comment">// æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">		<span class="built_in">this</span>.value = <span class="literal">null</span>;</span><br><span class="line">		<span class="comment">// å¤±è´¥ä¹‹åçš„åŸå› </span></span><br><span class="line">		<span class="built_in">this</span>.reason = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span></span><br><span class="line">		<span class="comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span></span><br><span class="line">		<span class="comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€ä¿®æ”¹ä¸ºæˆåŠŸ</span></span><br><span class="line">				<span class="built_in">this</span>.status = FULFILLED;</span><br><span class="line">				<span class="comment">// ä¿å­˜æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">				<span class="built_in">this</span>.value = value;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€æˆåŠŸä¸ºå¤±è´¥</span></span><br><span class="line">				<span class="built_in">this</span>.status = REJECTED;</span><br><span class="line">				<span class="comment">// ä¿å­˜å¤±è´¥åçš„åŸå› </span></span><br><span class="line">				<span class="built_in">this</span>.reason = reason;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœexecutoræ‰§è¡ŒæŠ¥é”™ï¼Œç›´æ¥æ‰§è¡Œreject</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			executor(resolve, reject);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">			reject(err);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">		<span class="comment">// åˆ¤æ–­çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.status === FULFILLED) &#123;</span><br><span class="line">			<span class="comment">// è°ƒç”¨æˆåŠŸå›è°ƒï¼Œå¹¶ä¸”æŠŠå€¼è¿”å›</span></span><br><span class="line">			onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === REJECTED) &#123;</span><br><span class="line">			<span class="comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span></span><br><span class="line">			onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¥½ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„ä»£ç è¿›è¡Œæµ‹è¯•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">				resolve(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">				reject(<span class="string">&#x27;err&#x27;</span>)</span><br><span class="line">			&#125;)</span><br><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, value)</span><br><span class="line">&#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;reject&#x27;</span>, reason)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//è¾“å‡ºä¸ºï¼šresolve success</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰é—®é¢˜ã€‚</p>
<h3 id="5-2-2-ç¬¬äºŒç‰ˆï¼šåŠ å…¥å¼‚æ­¥é€»è¾‘"><a href="#5-2-2-ç¬¬äºŒç‰ˆï¼šåŠ å…¥å¼‚æ­¥é€»è¾‘" class="headerlink" title="5.2.2 ç¬¬äºŒç‰ˆï¼šåŠ å…¥å¼‚æ­¥é€»è¾‘"></a>5.2.2 ç¬¬äºŒç‰ˆï¼šåŠ å…¥å¼‚æ­¥é€»è¾‘</h3><p>åœ¨ç¬¬ä¸€ç‰ˆä¸­ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜æˆ‘ä»¬æ²¡æœ‰è§£å†³ï¼šå½“resolveåœ¨setTomeoutå†…æ‰§è¡Œï¼Œthenæ—¶stateè¿˜æ˜¯pendingç­‰å¾…çŠ¶æ€ã€‚æ­£å¦‚ä¸‹æ–¹ä»£ç æ‰€ç¤º</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">				<span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> resolve(<span class="string">&#x27;success&#x27;</span>), <span class="number">0</span>)</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, value)</span><br><span class="line">&#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;reject&#x27;</span>, reason)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//è¾“å‡ºï¼š</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¾“å‡ºä¸ºç©ºï¼Œè¿™æ˜¯å› ä¸ºV8å¼•æ“ä¸­äº‹ä»¶å¾ªç¯çš„æœºåˆ¶å†³å®šäº†å…ˆæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå†æ‰§è¡Œå¼‚æ­¥ä»£ç ï¼Œè€ŒsetTimeoutä¸ºå¼‚æ­¥ä»£ç ï¼ŒV8ç›´æ¥å°†è¯¥ä»£ç æ”¾åˆ°â€œå®ä»»åŠ¡é˜Ÿåˆ—â€ï¼ˆå¯¼è‡´çš„åæœå°±æ˜¯çŠ¶æ€æ”¹å˜çš„å»¶åï¼‰ï¼Œå…ˆæ‰§è¡Œå‰©ä¸‹çš„åŒæ­¥ä»£ç ï¼Œå³thenæ–¹æ³•ï¼Œè€Œthenæ–¹æ³•ä¸­åˆ¤æ–­çŠ¶æ€çš„æ—¶å€™å‘ç°çŠ¶æ€è¿˜æ˜¯pendingï¼Œæ‰€ä»¥æ²¡æœ‰è¾“å‡ºã€‚</p>
<p><code>åˆ¤æ–­å¼‚æ­¥é€»è¾‘çš„æƒ…å†µ</code>ï¼š<strong>åœ¨thenæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™åˆ¤æ–­åˆ°çŠ¶æ€ä¸ºpendingçš„è¯ï¼Œå°±è¯´æ˜å‡ºç°äº†å¼‚æ­¥é€»è¾‘çš„æƒ…å†µäº†ã€‚</strong></p>
<p><code>è§£å†³æ–¹æ¡ˆ</code>ï¼š</p>
<ul>
<li><strong>å¢</strong>ï¼šç¼“å­˜thenå›è°ƒå‡½æ•°ï¼Œç„¶ååœ¨resolveæˆ–rejectå‡½æ•°çœŸæ­£æ‰§è¡Œæ—¶æ‰è°ƒç”¨å®ƒä»¬</li>
</ul>
<p>ç„¶åä»£ç å°±å¦‚ä¸‹äº†ï¼ŒğŸŒ™æ ‡æ³¨å‡ºäº†æ–°å¢çš„ä»£ç ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆå®šä¹‰ä¸‰ä¸ªå¸¸é‡è¡¨ç¤ºçŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> PENDING = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å»º MyPromise ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å‚¨å­˜çŠ¶æ€çš„å˜é‡ï¼Œåˆå§‹å€¼æ˜¯ pending</span></span><br><span class="line">		<span class="built_in">this</span>.status = PENDING;</span><br><span class="line">		<span class="comment">// æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">		<span class="built_in">this</span>.value = <span class="literal">null</span>;</span><br><span class="line">		<span class="comment">// å¤±è´¥ä¹‹åçš„åŸå› </span></span><br><span class="line">		<span class="built_in">this</span>.reason = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ğŸŒ™å­˜å‚¨æˆåŠŸå›è°ƒå‡½æ•°</span></span><br><span class="line">		<span class="built_in">this</span>.onFulfilledCallback = <span class="literal">null</span>;</span><br><span class="line">		<span class="comment">// ğŸŒ™å­˜å‚¨å¤±è´¥å›è°ƒå‡½æ•°</span></span><br><span class="line">		<span class="built_in">this</span>.onRejectedCallback = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span></span><br><span class="line">		<span class="comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span></span><br><span class="line">		<span class="comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€ä¿®æ”¹ä¸ºæˆåŠŸ</span></span><br><span class="line">				<span class="built_in">this</span>.status = FULFILLED;</span><br><span class="line">				<span class="comment">// ä¿å­˜æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">				<span class="built_in">this</span>.value = value;</span><br><span class="line">				<span class="comment">// ğŸŒ™åˆ¤æ–­æˆåŠŸå›è°ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨</span></span><br><span class="line">				<span class="built_in">this</span>.onFulfilledCallback &amp;&amp; <span class="built_in">this</span>.onFulfilledCallback(value);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€æˆåŠŸä¸ºå¤±è´¥</span></span><br><span class="line">				<span class="built_in">this</span>.status = REJECTED;</span><br><span class="line">				<span class="comment">// ä¿å­˜å¤±è´¥åçš„åŸå› </span></span><br><span class="line">				<span class="built_in">this</span>.reason = reason;</span><br><span class="line">				<span class="comment">// ğŸŒ™åˆ¤æ–­å¤±è´¥å›è°ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨</span></span><br><span class="line">				<span class="built_in">this</span>.onRejectedCallback &amp;&amp; <span class="built_in">this</span>.onRejectedCallback(reason)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœexecutoræ‰§è¡ŒæŠ¥é”™ï¼Œç›´æ¥æ‰§è¡Œreject</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			executor(resolve, reject);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">			reject(err);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">		<span class="comment">// åˆ¤æ–­çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.status === FULFILLED) &#123;</span><br><span class="line">			<span class="comment">// è°ƒç”¨æˆåŠŸå›è°ƒï¼Œå¹¶ä¸”æŠŠå€¼è¿”å›</span></span><br><span class="line">			onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === REJECTED) &#123;</span><br><span class="line">			<span class="comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span></span><br><span class="line">			onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">			<span class="comment">// ğŸŒ™</span></span><br><span class="line">			<span class="comment">// å› ä¸ºä¸çŸ¥é“åé¢çŠ¶æ€çš„å˜åŒ–æƒ…å†µï¼Œæ‰€ä»¥å°†æˆåŠŸå›è°ƒå’Œå¤±è´¥å›è°ƒå­˜å‚¨èµ·æ¥</span></span><br><span class="line">			<span class="comment">// ç­‰åˆ°æ‰§è¡ŒæˆåŠŸå¤±è´¥å‡½æ•°çš„æ—¶å€™å†ä¼ é€’</span></span><br><span class="line">			<span class="built_in">this</span>.onFulfilledCallback = onFulfilled;</span><br><span class="line">			<span class="built_in">this</span>.onRejectedCallback = onRejected;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™è¿›è¡Œæµ‹è¯•ï¼Œå°±å‘ç°å¯ä»¥æˆåŠŸè¾“å‡ºresolve successï¼Œå®ç°åŠŸèƒ½ã€‚</p>
<h3 id="5-2-3-ç¬¬ä¸‰ç‰ˆï¼šå®ç°thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨"><a href="#5-2-3-ç¬¬ä¸‰ç‰ˆï¼šå®ç°thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨" class="headerlink" title="5.2.3 ç¬¬ä¸‰ç‰ˆï¼šå®ç°thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨"></a>5.2.3 ç¬¬ä¸‰ç‰ˆï¼šå®ç°thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºä¸€ä¸ªpromiseå¯ä»¥è®¾å®šå¤šä¸ªthenæ–¹æ³•ï¼Œ<strong>éthené“¾å¼è°ƒç”¨ï¼ï¼</strong>ï¼Œå¦‚ä¸‹æ–¹ä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> resolve(<span class="string">&#x27;success&#x27;</span>), <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, value)</span><br><span class="line">&#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;reject&#x27;</span>, reason)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, value)</span><br><span class="line">&#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;reject&#x27;</span>, reason)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, value)</span><br><span class="line">&#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;reject&#x27;</span>, reason)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//é¢„æœŸè¾“å‡ºï¼š</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">resolve success</span><br><span class="line"><span class="number">2</span> </span><br><span class="line">resolve success</span><br><span class="line"><span class="number">3</span> </span><br><span class="line">resolve success</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®é™…è¾“å‡º:</span></span><br><span class="line"><span class="number">3</span> </span><br><span class="line">resolve success</span><br></pre></td></tr></table></figure>



<p><code>è§£å†³æ–¹æ¡ˆ</code>ï¼š</p>
<ul>
<li><strong>æ”¹</strong>ï¼šæ”¹ç”¨æ•°ç»„ç¼“å­˜å›è°ƒå‡½æ•°ã€‚</li>
<li><strong>æ”¹</strong>ï¼šresolveå’Œrejectè¦éå†ç¼“å­˜æ•°ç»„å¹¶æ‰§è¡Œ</li>
</ul>
<p>æˆ‘ä»¬ç”¨ğŸŒ™æ ‡æ³¨ä¿®æ”¹çš„åœ°æ–¹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆå®šä¹‰ä¸‰ä¸ªå¸¸é‡è¡¨ç¤ºçŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> PENDING = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å»º MyPromise ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å‚¨å­˜çŠ¶æ€çš„å˜é‡ï¼Œåˆå§‹å€¼æ˜¯ pending</span></span><br><span class="line">		<span class="built_in">this</span>.status = PENDING;</span><br><span class="line">		<span class="comment">// æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">		<span class="built_in">this</span>.value = <span class="literal">null</span>;</span><br><span class="line">		<span class="comment">// å¤±è´¥ä¹‹åçš„åŸå› </span></span><br><span class="line">		<span class="built_in">this</span>.reason = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ğŸŒ™å­˜å‚¨æˆåŠŸå›è°ƒå‡½æ•°</span></span><br><span class="line">		<span class="built_in">this</span>.onFulfilledCallback = [];</span><br><span class="line">		<span class="comment">// ğŸŒ™å­˜å‚¨å¤±è´¥å›è°ƒå‡½æ•°</span></span><br><span class="line">		<span class="built_in">this</span>.onRejectedCallback = [];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span></span><br><span class="line">		<span class="comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span></span><br><span class="line">		<span class="comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€ä¿®æ”¹ä¸ºæˆåŠŸ</span></span><br><span class="line">				<span class="built_in">this</span>.status = FULFILLED;</span><br><span class="line">				<span class="comment">// ä¿å­˜æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">				<span class="built_in">this</span>.value = value;</span><br><span class="line">				<span class="comment">// ğŸŒ™åˆ¤æ–­æˆåŠŸå›è°ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨</span></span><br><span class="line">				<span class="built_in">this</span>.onFulfilledCallback.forEach(<span class="function">(<span class="params">callback</span>) =&gt;</span> callback(value));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€æˆåŠŸä¸ºå¤±è´¥</span></span><br><span class="line">				<span class="built_in">this</span>.status = REJECTED;</span><br><span class="line">				<span class="comment">// ä¿å­˜å¤±è´¥åçš„åŸå› </span></span><br><span class="line">				<span class="built_in">this</span>.reason = reason;</span><br><span class="line">				<span class="comment">// ğŸŒ™åˆ¤æ–­å¤±è´¥å›è°ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨</span></span><br><span class="line">				<span class="built_in">this</span>.onRejectedCallback.forEach(<span class="function">(<span class="params">callback</span>) =&gt;</span> callback(reason));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœexecutoræ‰§è¡ŒæŠ¥é”™ï¼Œç›´æ¥æ‰§è¡Œreject</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			executor(resolve, reject);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">			reject(err);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">		<span class="comment">// åˆ¤æ–­çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.status === FULFILLED) &#123;</span><br><span class="line">			<span class="comment">// è°ƒç”¨æˆåŠŸå›è°ƒï¼Œå¹¶ä¸”æŠŠå€¼è¿”å›</span></span><br><span class="line">			onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === REJECTED) &#123;</span><br><span class="line">			<span class="comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span></span><br><span class="line">			onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">			<span class="comment">// ğŸŒ™</span></span><br><span class="line">			<span class="comment">// å› ä¸ºä¸çŸ¥é“åé¢çŠ¶æ€çš„å˜åŒ–æƒ…å†µï¼Œæ‰€ä»¥å°†æˆåŠŸå›è°ƒå’Œå¤±è´¥å›è°ƒå­˜å‚¨èµ·æ¥</span></span><br><span class="line">			<span class="comment">// ç­‰åˆ°æ‰§è¡ŒæˆåŠŸå¤±è´¥å‡½æ•°çš„æ—¶å€™å†ä¼ é€’</span></span><br><span class="line">			<span class="built_in">this</span>.onFulfilledCallback.push(onFulfilled);</span><br><span class="line">			<span class="built_in">this</span>.onRejectedCallback.push(onRejected);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†é‡æ–°æµ‹è¯•ä¸€ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®é™…è¾“å‡ºï¼š</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">resolve success</span><br><span class="line"><span class="number">2</span> </span><br><span class="line">resolve success</span><br><span class="line"><span class="number">3</span> </span><br><span class="line">resolve success</span><br></pre></td></tr></table></figure>



<h3 id="5-2-4-ç¬¬å››ç‰ˆï¼šå®ç°thené“¾å¼è°ƒç”¨"><a href="#5-2-4-ç¬¬å››ç‰ˆï¼šå®ç°thené“¾å¼è°ƒç”¨" class="headerlink" title="5.2.4 ç¬¬å››ç‰ˆï¼šå®ç°thené“¾å¼è°ƒç”¨"></a>5.2.4 ç¬¬å››ç‰ˆï¼šå®ç°thené“¾å¼è°ƒç”¨</h3><p>ä¸Šé¢çš„ä»£ç è¿˜èƒ½å¤Ÿè¿›ä¸€æ­¥å®Œå–„ï¼Œæˆ‘ä»¬å¸Œæœ›ä»£ç å¯ä»¥å¤„ç†promiseçš„é“¾å¼è°ƒç”¨ï¼Œå³<code>new Promise().then().then().then()</code>ã€‚åŸç†å°±æ˜¯thenæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„promiseå¯¹è±¡ï¼Œä½†æ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬å®ç°çš„thenæ–¹æ³•ä¸­æ˜æ˜¾æ²¡æœ‰è¿”å›ä¸€ä¸ªæ–°çš„promiseå¯¹è±¡ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆå›é¡¾ä¸€ä¸‹thenå‡½æ•°ä¸­çš„è¿”å›å€¼ä¸æ–°Promiseçš„å…³ç³»ï¼š</p>
<blockquote>
<ul>
<li>å¦‚æœæŠ›å‡ºå¼‚å¸¸, æ–° promise å˜ä¸º rejected, reason ä¸ºæŠ›å‡ºçš„å¼‚å¸¸</li>
<li>å¦‚æœè¿”å›çš„æ˜¯é promise çš„ä»»æ„å€¼, æ–° promise å˜ä¸º resolved, value ä¸ºè¿”å›çš„å€¼</li>
<li>å¦‚æœè¿”å›çš„æ˜¯å¦ä¸€ä¸ªæ–° promise, æ­¤ promise çš„ç»“æœå°±ä¼šæˆä¸ºæ–° promise çš„ç»“æœ</li>
</ul>
</blockquote>
<p>å› æ­¤æˆ‘ä»¬é¦–å…ˆè¦åœ¨thenä¸­è¿”å›ä¸€ä¸ªPromiseã€‚ç„¶åè®°å¾—å°†å›è°ƒå‡½æ•°çš„è¿”å›å€¼å­˜èµ·æ¥ï¼Œå¹¶ç”¨ä¸€ä¸ªresolvePromiseå‡½æ•°è¿›è¡Œ3ç§æƒ…å†µçš„åˆ¤æ–­ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹ï¼š<strong>thenå‡½æ•°æ˜¯å¼‚æ­¥çš„</strong>ã€‚</p>
<p><code>è§£å†³æ–¹æ¡ˆ</code>ï¼š</p>
<ul>
<li><strong>æ”¹</strong>ï¼šthenå‡½æ•°é‡Œnewä¸€ä¸ªPromiseå¹¶ä½œä¸ºthenå‡½æ•°è¿”å›å€¼</li>
<li><strong>æ”¹</strong>ï¼šç”¨queueMicrotaskï¼ˆï¼‰å®ç°thençš„å¼‚æ­¥å¾®ä»»åŠ¡</li>
<li><strong>å¢</strong>ï¼šç”¨ä¸€ä¸ªresolvePromiseå‡½æ•°è¿›è¡Œthenå‡½æ•°è¿”å›å€¼ åˆ¤æ–­ã€å¤„ç†ï¼ŒåŒæ—¶ç”¨try-catchæ•è·å¼‚å¸¸</li>
<li><strong>å¢</strong>ï¼šresolvePromiseå‡½æ•°é‡Œè¦åˆ¤æ–­ <u>then æ–¹æ³•è¿”å›äº†è‡ªå·±çš„ Promise å¯¹è±¡</u></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å»º MyPromise ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//ğŸŒ™ ä¸ºäº†é“¾å¼è°ƒç”¨è¿™é‡Œç›´æ¥åˆ›å»ºä¸€ä¸ª MyPromiseï¼Œå¹¶åœ¨åé¢ return å‡ºå»</span></span><br><span class="line">        <span class="comment">// â­ ç®­å¤´å‡½æ•°ä¸­çš„ this ä¼šè‡ªåŠ¨æ•è·&quot;å®šä¹‰æ—¶&quot;å¤–å±‚æœ€è¿‘çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè€Œéè¿è¡Œæ—¶ç»‘å®šï¼Œæ‰€ä»¥äº‹å®ä¸ŠthisæŒ‡å‘æ˜¯ç¬¬ä¸€ä¸ªpromiseï¼Œè€Œä¸æ˜¯promise2</span></span><br><span class="line">		<span class="keyword">let</span> promise2 = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åˆ¤æ–­çŠ¶æ€</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === FULFILLED) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">					<span class="keyword">let</span> x = onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">					<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">					resolvePromise(x, resolve, reject);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">					reject(error)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === REJECTED) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span></span><br><span class="line">					<span class="keyword">const</span> x = onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">					<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">					resolvePromise(x, resolve, reject);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">					reject(error)</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">                </span><br><span class="line">				<span class="comment">//ğŸŒ™  å› ä¸ºä¸çŸ¥é“åé¢çŠ¶æ€çš„å˜åŒ–æƒ…å†µï¼Œæ‰€ä»¥å°†æˆåŠŸå›è°ƒå­˜å‚¨èµ·æ¥</span></span><br><span class="line">				<span class="built_in">this</span>.onFulfilledCallbacks.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">						<span class="keyword">const</span> x = onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">						<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">						resolvePromise(x, resolve, reject);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">						reject(error)</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">				&#125;);</span><br><span class="line">				</span><br><span class="line">                <span class="comment">//ğŸŒ™  å› ä¸ºä¸çŸ¥é“åé¢çŠ¶æ€çš„å˜åŒ–æƒ…å†µï¼Œæ‰€ä»¥å°†å¤±è´¥å›è°ƒå­˜å‚¨èµ·æ¥</span></span><br><span class="line">				<span class="built_in">this</span>.onRejectedCallbacks.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span></span><br><span class="line">						<span class="keyword">const</span> x = onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">						<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">						resolvePromise( x, resolve, reject);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">						reject(error)</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">				&#125;);</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> promise2;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//ğŸŒ™</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">x, resolve, reject</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ¤æ–­xæ˜¯ä¸æ˜¯ MyPromise å®ä¾‹å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">if</span> (x <span class="keyword">instanceof</span> MyPromise) &#123;</span><br><span class="line">         <span class="comment">// å¦‚æœè¿”å›å€¼æ˜¯Promise</span></span><br><span class="line">         <span class="comment">// å¦‚æœè¿”å›å€¼æ˜¯promiseå¯¹è±¡ï¼Œè¿”å›å€¼ä¸ºæˆåŠŸï¼Œæ–°promiseå°±æ˜¯æˆåŠŸ</span></span><br><span class="line">         <span class="comment">// å¦‚æœè¿”å›å€¼æ˜¯promiseå¯¹è±¡ï¼Œè¿”å›å€¼ä¸ºå¤±è´¥ï¼Œæ–°promiseå°±æ˜¯å¤±è´¥</span></span><br><span class="line">         <span class="comment">// è°çŸ¥é“è¿”å›çš„promiseæ˜¯å¤±è´¥æˆåŠŸï¼Ÿåªæœ‰thençŸ¥é“ï¼Œæ‰€ä»¥å°±è®©thenå¸®æˆ‘ä»¬æ‰§è¡Œresolveæˆ–è€…rejectå‡½æ•°</span></span><br><span class="line">		x.then(resolve, reject)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// æ™®é€šå€¼</span></span><br><span class="line">		resolve(x)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å­è¶³å¤Ÿäº†å—ï¼Ÿè¿™æ ·å­æµ‹è¯•çš„æ—¶å€™ä¼šæŠ¥é”™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cannot access &#x27;p1&#x27; before initialization</span><br></pre></td></tr></table></figure>

<p>ä¸ºå•¥ä¼šæŠ¥é”™å‘¢ï¼Ÿä»é”™è¯¯æç¤ºå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å¿…é¡»è¦ç­‰ promise2 å®Œæˆåˆå§‹åŒ–ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦ç”¨ä¸Šå®å¾®ä»»åŠ¡å’Œäº‹ä»¶å¾ªç¯çš„çŸ¥è¯†äº†ï¼Œè¿™é‡Œå°±éœ€è¦åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å‡½æ•°å»ç­‰å¾… promise2 å®Œæˆåˆå§‹åŒ–ï¼Œå‰é¢æˆ‘ä»¬å·²ç»ç¡®è®¤äº†åˆ›å»ºå¾®ä»»åŠ¡çš„æŠ€æœ¯æ–¹æ¡ˆ â€“&gt; <code>queueMicrotask</code></p>
<p>äºæ˜¯åƒè¿™æ ·å­æ”¹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise.js</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> promise2 = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === FULFILLED) &#123;</span><br><span class="line">        <span class="comment">//ğŸŒ™</span></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå¾®ä»»åŠ¡ç­‰å¾… promise2 å®Œæˆåˆå§‹åŒ–</span></span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">          <span class="keyword">const</span> x = onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">          <span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">          resolvePromise(x, resolve, reject);</span><br><span class="line">        &#125;)  </span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === REJECTED) &#123;</span><br><span class="line">      ......</span><br><span class="line">    &#125;) </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> promise2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å­è¶³å¤Ÿäº†å—ï¼Ÿæ²¡æœ‰ï¼Œå¦‚ä¸‹æ–¹ä¾‹å­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">100</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p1 = promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value)</span><br><span class="line">  <span class="keyword">return</span> p1</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ then æ–¹æ³•è¿”å›çš„æ˜¯è‡ªå·±çš„ Promise å¯¹è±¡ï¼Œåˆ™ä¼šå‘ç”Ÿå¾ªç¯è°ƒç”¨ï¼Œè¿™ä¸ªæ—¶å€™ç¨‹åºä¼šæŠ¥é”™</p>
<p>å› æ­¤æˆ‘ä»¬è¦æŠŠpromise2ä¸€èµ·ä¼ è¿›å»resolvePromiseå‡½æ•°ä¸­ï¼Œå¦‚æœx==promise2ï¼Œè¯´æ˜å‡ºç°è¿™ç§æƒ…å†µ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">    <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;Chaining cycle detected for promise #&lt;Promise&gt;&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆä»£ç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆå®šä¹‰ä¸‰ä¸ªå¸¸é‡è¡¨ç¤ºçŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> PENDING = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å»º MyPromise ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å‚¨å­˜çŠ¶æ€çš„å˜é‡ï¼Œåˆå§‹å€¼æ˜¯ pending</span></span><br><span class="line">		<span class="built_in">this</span>.status = PENDING;</span><br><span class="line">		<span class="comment">// æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">		<span class="built_in">this</span>.value = <span class="literal">null</span>;</span><br><span class="line">		<span class="comment">// å¤±è´¥ä¹‹åçš„åŸå› </span></span><br><span class="line">		<span class="built_in">this</span>.reason = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å­˜å‚¨æˆåŠŸå›è°ƒå‡½æ•°</span></span><br><span class="line">		<span class="built_in">this</span>.onFulfilledCallback = [];</span><br><span class="line">		<span class="comment">// å­˜å‚¨å¤±è´¥å›è°ƒå‡½æ•°</span></span><br><span class="line">		<span class="built_in">this</span>.onRejectedCallback = [];</span><br><span class="line"></span><br><span class="line">		<span class="comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span></span><br><span class="line">		<span class="comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span></span><br><span class="line">		<span class="comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€ä¿®æ”¹ä¸ºæˆåŠŸ</span></span><br><span class="line">				<span class="built_in">this</span>.status = FULFILLED;</span><br><span class="line">				<span class="comment">// ä¿å­˜æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">				<span class="built_in">this</span>.value = value;</span><br><span class="line">				<span class="comment">// åˆ¤æ–­æˆåŠŸå›è°ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨</span></span><br><span class="line">				<span class="built_in">this</span>.onFulfilledCallback.forEach(<span class="function">(<span class="params">callback</span>) =&gt;</span> callback(value));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€æˆåŠŸä¸ºå¤±è´¥</span></span><br><span class="line">				<span class="built_in">this</span>.status = REJECTED;</span><br><span class="line">				<span class="comment">// ä¿å­˜å¤±è´¥åçš„åŸå› </span></span><br><span class="line">				<span class="built_in">this</span>.reason = reason;</span><br><span class="line">				<span class="comment">// åˆ¤æ–­å¤±è´¥å›è°ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨</span></span><br><span class="line">				<span class="built_in">this</span>.onRejectedCallback.forEach(<span class="function">(<span class="params">callback</span>) =&gt;</span> callback(reason));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœexecutoræ‰§è¡ŒæŠ¥é”™ï¼Œç›´æ¥æ‰§è¡Œreject</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			executor(resolve, reject);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">			reject(err);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//ğŸŒ™ ä¸ºäº†é“¾å¼è°ƒç”¨è¿™é‡Œç›´æ¥åˆ›å»ºä¸€ä¸ª MyPromiseï¼Œå¹¶åœ¨åé¢ return å‡ºå»</span></span><br><span class="line">		<span class="keyword">let</span> promise2 = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åˆ¤æ–­çŠ¶æ€</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === FULFILLED) &#123;</span><br><span class="line">				queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">						<span class="keyword">let</span> x = onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">						<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">						resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">						reject(error)</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === REJECTED) &#123;</span><br><span class="line">				queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span></span><br><span class="line">						<span class="keyword">const</span> x = onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">						<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">						resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">						reject(error)</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// ğŸŒ™</span></span><br><span class="line">				<span class="comment">// å› ä¸ºä¸çŸ¥é“åé¢çŠ¶æ€çš„å˜åŒ–æƒ…å†µï¼Œæ‰€ä»¥å°†æˆåŠŸå›è°ƒå’Œå¤±è´¥å›è°ƒå­˜å‚¨èµ·æ¥</span></span><br><span class="line">				<span class="comment">// ç­‰åˆ°æ‰§è¡ŒæˆåŠŸå¤±è´¥å‡½æ•°çš„æ—¶å€™å†ä¼ é€’</span></span><br><span class="line"></span><br><span class="line">				<span class="built_in">this</span>.onFulfilledCallback.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="comment">// ğŸŒ™</span></span><br><span class="line">					queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							<span class="comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">							<span class="keyword">const</span> x = onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">							<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">							resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">						&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">							reject(error)</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;);</span><br><span class="line">				<span class="built_in">this</span>.onRejectedCallback.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="comment">// ğŸŒ™</span></span><br><span class="line">					queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							<span class="comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span></span><br><span class="line">							<span class="keyword">const</span> x = onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">							<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">							resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">						&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">							reject(error)</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> promise2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›</span></span><br><span class="line">	<span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">		<span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;Chaining cycle detected for promise #&lt;Promise&gt;&#x27;</span>))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ¤æ–­xæ˜¯ä¸æ˜¯ Promise å®ä¾‹å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">if</span> (x <span class="keyword">instanceof</span> MyPromise) &#123;</span><br><span class="line">		<span class="comment">// æ‰§è¡Œ xï¼Œè°ƒç”¨ then æ–¹æ³•ï¼Œç›®çš„æ˜¯å°†å…¶çŠ¶æ€å˜ä¸º fulfilled æˆ–è€… rejected</span></span><br><span class="line">		<span class="comment">// x.then(value =&gt; resolve(value), reason =&gt; reject(reason))</span></span><br><span class="line">		<span class="comment">// ç®€åŒ–ä¹‹å</span></span><br><span class="line">		x.then(resolve, reject)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// æ™®é€šå€¼</span></span><br><span class="line">		resolve(x)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-5-ç¬¬äº”ç‰ˆï¼šå®ç°thenå‚æ•°é»˜è®¤å‡½æ•°ã€catchæ–¹æ³•"><a href="#5-2-5-ç¬¬äº”ç‰ˆï¼šå®ç°thenå‚æ•°é»˜è®¤å‡½æ•°ã€catchæ–¹æ³•" class="headerlink" title="5.2.5 ç¬¬äº”ç‰ˆï¼šå®ç°thenå‚æ•°é»˜è®¤å‡½æ•°ã€catchæ–¹æ³•"></a>5.2.5 ç¬¬äº”ç‰ˆï¼šå®ç°thenå‚æ•°é»˜è®¤å‡½æ•°ã€catchæ–¹æ³•</h3><p>åŸç”Ÿ Promise æ˜¯å¯ä»¥é€‰æ‹©å‚æ•°çš„å•ä¼ æˆ–è€…ä¸ä¼ ï¼Œéƒ½ä¸ä¼šå½±å“æ‰§è¡Œï¼Œåƒè¿™æ ·</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">100</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise</span><br><span class="line">  .then()</span><br><span class="line">  .then()</span><br><span class="line">  .then()</span><br><span class="line">  .then(<span class="function"><span class="params">value</span> =&gt;</span> <span class="built_in">console</span>.log(value))</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„æœŸè¾“å‡ºï¼š 100</span></span><br><span class="line"><span class="comment">// å®é™…è¾“å‡ºï¼š </span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ then æ–¹æ³•åšä¸€ç‚¹å°å°çš„è°ƒæ•´</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœä¸ä¼ ï¼Œå°±ä½¿ç”¨é»˜è®¤å‡½æ•°</span></span><br><span class="line">  onFulfilled = <span class="keyword">typeof</span> onFulfilled === <span class="string">&#x27;function&#x27;</span> ? onFulfilled : <span class="function"><span class="params">value</span> =&gt;</span> value;</span><br><span class="line">  onRejected = <span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span> ? onRejected : <span class="function"><span class="params">reason</span> =&gt;</span> &#123;<span class="keyword">throw</span> reason&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸ºäº†é“¾å¼è°ƒç”¨è¿™é‡Œç›´æ¥åˆ›å»ºä¸€ä¸ª MyPromiseï¼Œå¹¶åœ¨åé¢ return å‡ºå»</span></span><br><span class="line">  <span class="keyword">const</span> promise2 = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆå®šä¹‰ä¸‰ä¸ªå¸¸é‡è¡¨ç¤ºçŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> PENDING = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å»º MyPromise ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å‚¨å­˜çŠ¶æ€çš„å˜é‡ï¼Œåˆå§‹å€¼æ˜¯ pending</span></span><br><span class="line">		<span class="built_in">this</span>.status = PENDING;</span><br><span class="line">		<span class="comment">// æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">		<span class="built_in">this</span>.value = <span class="literal">null</span>;</span><br><span class="line">		<span class="comment">// å¤±è´¥ä¹‹åçš„åŸå› </span></span><br><span class="line">		<span class="built_in">this</span>.reason = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å­˜å‚¨æˆåŠŸå›è°ƒå‡½æ•°</span></span><br><span class="line">		<span class="built_in">this</span>.onFulfilledCallback = [];</span><br><span class="line">		<span class="comment">// å­˜å‚¨å¤±è´¥å›è°ƒå‡½æ•°</span></span><br><span class="line">		<span class="built_in">this</span>.onRejectedCallback = [];</span><br><span class="line"></span><br><span class="line">		<span class="comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span></span><br><span class="line">		<span class="comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span></span><br><span class="line">		<span class="comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€ä¿®æ”¹ä¸ºæˆåŠŸ</span></span><br><span class="line">				<span class="built_in">this</span>.status = FULFILLED;</span><br><span class="line">				<span class="comment">// ä¿å­˜æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">				<span class="built_in">this</span>.value = value;</span><br><span class="line">				<span class="comment">// åˆ¤æ–­æˆåŠŸå›è°ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨</span></span><br><span class="line">				<span class="built_in">this</span>.onFulfilledCallback.forEach(<span class="function">(<span class="params">callback</span>) =&gt;</span> callback(value));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€æˆåŠŸä¸ºå¤±è´¥</span></span><br><span class="line">				<span class="built_in">this</span>.status = REJECTED;</span><br><span class="line">				<span class="comment">// ä¿å­˜å¤±è´¥åçš„åŸå› </span></span><br><span class="line">				<span class="built_in">this</span>.reason = reason;</span><br><span class="line">				<span class="comment">// åˆ¤æ–­å¤±è´¥å›è°ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨</span></span><br><span class="line">				<span class="built_in">this</span>.onRejectedCallback.forEach(<span class="function">(<span class="params">callback</span>) =&gt;</span> callback(reason));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœexecutoræ‰§è¡ŒæŠ¥é”™ï¼Œç›´æ¥æ‰§è¡Œreject</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			executor(resolve, reject);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">			reject(err);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">		<span class="comment">// å¦‚æœä¸ä¼ ï¼Œå°±ä½¿ç”¨é»˜è®¤å‡½æ•°</span></span><br><span class="line">		onFulfilled = <span class="keyword">typeof</span> onFulfilled === <span class="string">&#x27;function&#x27;</span> ? onFulfilled : <span class="function"><span class="params">value</span> =&gt;</span> value;</span><br><span class="line">		onRejected = <span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span> ? onRejected : <span class="function"><span class="params">reason</span> =&gt;</span> &#123;<span class="keyword">throw</span> reason&#125;;</span><br><span class="line">		<span class="comment">//ğŸŒ™ ä¸ºäº†é“¾å¼è°ƒç”¨è¿™é‡Œç›´æ¥åˆ›å»ºä¸€ä¸ª MyPromiseï¼Œå¹¶åœ¨åé¢ return å‡ºå»</span></span><br><span class="line">		<span class="keyword">let</span> promise2 = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åˆ¤æ–­çŠ¶æ€</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === FULFILLED) &#123;</span><br><span class="line">				queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">						<span class="keyword">let</span> x = onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">						<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">						resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">						reject(error)</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === REJECTED) &#123;</span><br><span class="line">				queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span></span><br><span class="line">						<span class="keyword">const</span> x = onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">						<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">						resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">						reject(error)</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// ğŸŒ™</span></span><br><span class="line">				<span class="comment">// å› ä¸ºä¸çŸ¥é“åé¢çŠ¶æ€çš„å˜åŒ–æƒ…å†µï¼Œæ‰€ä»¥å°†æˆåŠŸå›è°ƒå’Œå¤±è´¥å›è°ƒå­˜å‚¨èµ·æ¥</span></span><br><span class="line">				<span class="comment">// ç­‰åˆ°æ‰§è¡ŒæˆåŠŸå¤±è´¥å‡½æ•°çš„æ—¶å€™å†ä¼ é€’</span></span><br><span class="line"></span><br><span class="line">				<span class="built_in">this</span>.onFulfilledCallback.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="comment">// ğŸŒ™</span></span><br><span class="line">					queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							<span class="comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">							<span class="keyword">const</span> x = onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">							<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">							resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">						&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">							reject(error)</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;);</span><br><span class="line">				<span class="built_in">this</span>.onRejectedCallback.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="comment">// ğŸŒ™</span></span><br><span class="line">					queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							<span class="comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span></span><br><span class="line">							<span class="keyword">const</span> x = onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">							<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">							resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">						&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">							reject(error)</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> promise2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›</span></span><br><span class="line">	<span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">		<span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;Chaining cycle detected for promise #&lt;Promise&gt;&#x27;</span>))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ¤æ–­xæ˜¯ä¸æ˜¯ Promise å®ä¾‹å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">if</span> (x <span class="keyword">instanceof</span> MyPromise) &#123;</span><br><span class="line">		<span class="comment">// æ‰§è¡Œ xï¼Œè°ƒç”¨ then æ–¹æ³•ï¼Œç›®çš„æ˜¯å°†å…¶çŠ¶æ€å˜ä¸º fulfilled æˆ–è€… rejected</span></span><br><span class="line">		<span class="comment">// x.then(value =&gt; resolve(value), reason =&gt; reject(reason))</span></span><br><span class="line">		<span class="comment">// ç®€åŒ–ä¹‹å</span></span><br><span class="line">		x.then(resolve, reject)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// æ™®é€šå€¼</span></span><br><span class="line">		resolve(x)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>catchæ–¹æ³•å¾ˆç®€å•å•¦</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;...&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">catch</span>(onRejected)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.then(<span class="literal">null</span>, onRejected);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹ï¼Œå°±æ˜¯è¿™ä¹ˆå‡ è¡Œï¼Œcatch åŸæœ¬å°±æ˜¯ then æ–¹æ³•çš„è¯­æ³•ç³–ã€‚</p>
<h3 id="5-2-6-ç¬¬å…­ç‰ˆï¼šè§„æ•´ä»£ç "><a href="#5-2-6-ç¬¬å…­ç‰ˆï¼šè§„æ•´ä»£ç " class="headerlink" title="5.2.6 ç¬¬å…­ç‰ˆï¼šè§„æ•´ä»£ç "></a>5.2.6 ç¬¬å…­ç‰ˆï¼šè§„æ•´ä»£ç </h3><p>ä¸Šé¢çš„ä»£ç æœ‰äº›å†—ä½™ï¼Œæˆ‘ä»¬è§„æ•´ä¸€ä¸‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆå®šä¹‰ä¸‰ä¸ªå¸¸é‡è¡¨ç¤ºçŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> PENDING = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å»º MyPromise ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å‚¨å­˜çŠ¶æ€çš„å˜é‡ï¼Œåˆå§‹å€¼æ˜¯ pending</span></span><br><span class="line">		<span class="built_in">this</span>.status = PENDING;</span><br><span class="line">		<span class="comment">// æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">		<span class="built_in">this</span>.value = <span class="literal">null</span>;</span><br><span class="line">		<span class="comment">// å¤±è´¥ä¹‹åçš„åŸå› </span></span><br><span class="line">		<span class="built_in">this</span>.reason = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å­˜å‚¨æˆåŠŸå›è°ƒå‡½æ•°</span></span><br><span class="line">		<span class="built_in">this</span>.onFulfilledCallback = [];</span><br><span class="line">		<span class="comment">// å­˜å‚¨å¤±è´¥å›è°ƒå‡½æ•°</span></span><br><span class="line">		<span class="built_in">this</span>.onRejectedCallback = [];</span><br><span class="line"></span><br><span class="line">		<span class="comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span></span><br><span class="line">		<span class="comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span></span><br><span class="line">		<span class="comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€ä¿®æ”¹ä¸ºæˆåŠŸ</span></span><br><span class="line">				<span class="built_in">this</span>.status = FULFILLED;</span><br><span class="line">				<span class="comment">// ä¿å­˜æˆåŠŸä¹‹åçš„å€¼</span></span><br><span class="line">				<span class="built_in">this</span>.value = value;</span><br><span class="line">				<span class="comment">// åˆ¤æ–­æˆåŠŸå›è°ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨</span></span><br><span class="line">				<span class="built_in">this</span>.onFulfilledCallback.forEach(<span class="function">(<span class="params">callback</span>) =&gt;</span> callback(value));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span></span><br><span class="line">		<span class="keyword">let</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// åªæœ‰çŠ¶æ€æ˜¯ç­‰å¾…ï¼Œæ‰æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// çŠ¶æ€æˆåŠŸä¸ºå¤±è´¥</span></span><br><span class="line">				<span class="built_in">this</span>.status = REJECTED;</span><br><span class="line">				<span class="comment">// ä¿å­˜å¤±è´¥åçš„åŸå› </span></span><br><span class="line">				<span class="built_in">this</span>.reason = reason;</span><br><span class="line">				<span class="comment">// åˆ¤æ–­å¤±è´¥å›è°ƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨</span></span><br><span class="line">				<span class="built_in">this</span>.onRejectedCallback.forEach(<span class="function">(<span class="params">callback</span>) =&gt;</span> callback(reason));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœexecutoræ‰§è¡ŒæŠ¥é”™ï¼Œç›´æ¥æ‰§è¡Œreject</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			executor(resolve, reject);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">			reject(err);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">		<span class="comment">// å¦‚æœä¸ä¼ ï¼Œå°±ä½¿ç”¨é»˜è®¤å‡½æ•°</span></span><br><span class="line">		onFulfilled = <span class="keyword">typeof</span> onFulfilled === <span class="string">&#x27;function&#x27;</span> ? onFulfilled : <span class="function"><span class="params">value</span> =&gt;</span> value;</span><br><span class="line">		onRejected = <span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span> ? onRejected : <span class="function"><span class="params">reason</span> =&gt;</span> &#123; <span class="keyword">throw</span> reason &#125;;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//ğŸŒ™ ä¸ºäº†é“¾å¼è°ƒç”¨è¿™é‡Œç›´æ¥åˆ›å»ºä¸€ä¸ª MyPromiseï¼Œå¹¶åœ¨åé¢ return å‡ºå»</span></span><br><span class="line">		<span class="keyword">let</span> promise2 = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">//ğŸŒ™æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">			<span class="keyword">let</span> fulfilledMicrotask = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">				queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">						<span class="keyword">let</span> x = onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">						<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">						resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">						reject(error)</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line"></span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//ğŸŒ™å¤±è´¥å›è°ƒ</span></span><br><span class="line">			<span class="keyword">let</span> rejectedMicrotask = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">				queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span></span><br><span class="line">						<span class="keyword">let</span> x = onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">						<span class="comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span></span><br><span class="line">						resolvePromise(promise2, x, resolve, reject);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">						reject(error)</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// åˆ¤æ–­çŠ¶æ€</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.status === FULFILLED) &#123;</span><br><span class="line">				fulfilledMicrotask()</span><br><span class="line"></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === REJECTED) &#123;</span><br><span class="line">				rejectedMicrotask()</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">				<span class="comment">// ğŸŒ™</span></span><br><span class="line">				<span class="comment">// å› ä¸ºä¸çŸ¥é“åé¢çŠ¶æ€çš„å˜åŒ–æƒ…å†µï¼Œæ‰€ä»¥å°†æˆåŠŸå›è°ƒå’Œå¤±è´¥å›è°ƒå­˜å‚¨èµ·æ¥</span></span><br><span class="line">				<span class="comment">// ç­‰åˆ°æ‰§è¡ŒæˆåŠŸå¤±è´¥å‡½æ•°çš„æ—¶å€™å†ä¼ é€’</span></span><br><span class="line"></span><br><span class="line">				<span class="built_in">this</span>.onFulfilledCallback.push(fulfilledMicrotask);</span><br><span class="line">				<span class="built_in">this</span>.onRejectedCallback.push(rejectedMicrotask);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> promise2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">catch</span> (onRejected) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.then(<span class="literal">null</span>, onRejected);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›</span></span><br><span class="line">	<span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">		<span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;Chaining cycle detected for promise #&lt;Promise&gt;&#x27;</span>))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ¤æ–­xæ˜¯ä¸æ˜¯ Promise å®ä¾‹å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">if</span> (x <span class="keyword">instanceof</span> MyPromise) &#123;</span><br><span class="line">		<span class="comment">// æ‰§è¡Œ xï¼Œè°ƒç”¨ then æ–¹æ³•ï¼Œç›®çš„æ˜¯å°†å…¶çŠ¶æ€å˜ä¸º fulfilled æˆ–è€… rejected</span></span><br><span class="line">		<span class="comment">// x.then(value =&gt; resolve(value), reason =&gt; reject(reason))</span></span><br><span class="line">		<span class="comment">// ç®€åŒ–ä¹‹å</span></span><br><span class="line">		x.then(resolve, reject)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// æ™®é€šå€¼</span></span><br><span class="line">		resolve(x)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-7-ç¬¬ä¸ƒç‰ˆï¼šç¬¦åˆA-è§„èŒƒç‰ˆæœ¬"><a href="#5-2-7-ç¬¬ä¸ƒç‰ˆï¼šç¬¦åˆA-è§„èŒƒç‰ˆæœ¬" class="headerlink" title="5.2.7  ç¬¬ä¸ƒç‰ˆï¼šç¬¦åˆA+è§„èŒƒç‰ˆæœ¬"></a>5.2.7  ç¬¬ä¸ƒç‰ˆï¼šç¬¦åˆA+è§„èŒƒç‰ˆæœ¬</h3><p>å’±ä»¬ä¸Šé¢å†™çš„resolvePromiseï¼ˆï¼‰å¹¶ä¸ç¬¦åˆPromise A+ è§„èŒƒï¼Œè¯¦ç»†çš„è§„èŒƒå¦‚ä¸‹</p>
<img data-src="https://gitee.com/monkey-HH/picBed/raw/master/picbed/img/202111161200140.png" alt="image-20211116115959924" style="zoom: 67%;" />

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">promise, x, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (promise === x) &#123;</span><br><span class="line">    <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;The promise and the return value are the same&#x27;</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// x ä¸º null ç›´æ¥è¿”å›ï¼Œèµ°åé¢çš„é€»è¾‘ä¼šæŠ¥é”™</span></span><br><span class="line">    <span class="keyword">if</span> (x === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> resolve(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> then;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// æŠŠ x.then èµ‹å€¼ç»™ then </span></span><br><span class="line">      then = x.then;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœå– x.then çš„å€¼æ—¶æŠ›å‡ºé”™è¯¯ error ï¼Œåˆ™ä»¥ error ä¸ºæ®å› æ‹’ç» promise</span></span><br><span class="line">      <span class="keyword">return</span> reject(error);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœ then æ˜¯å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> called = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        then.call(</span><br><span class="line">          x, <span class="comment">// this æŒ‡å‘ x</span></span><br><span class="line">          <span class="comment">// å¦‚æœ resolvePromise ä»¥å€¼ y ä¸ºå‚æ•°è¢«è°ƒç”¨ï¼Œåˆ™è¿è¡Œ [[Resolve]](promise, y)</span></span><br><span class="line">          <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœ resolvePromise å’Œ rejectPromise å‡è¢«è°ƒç”¨ï¼Œ</span></span><br><span class="line">            <span class="comment">// æˆ–è€…è¢«åŒä¸€å‚æ•°è°ƒç”¨äº†å¤šæ¬¡ï¼Œåˆ™ä¼˜å…ˆé‡‡ç”¨é¦–æ¬¡è°ƒç”¨å¹¶å¿½ç•¥å‰©ä¸‹çš„è°ƒç”¨</span></span><br><span class="line">            <span class="comment">// å®ç°è¿™æ¡éœ€è¦å‰é¢åŠ ä¸€ä¸ªå˜é‡ called</span></span><br><span class="line">            <span class="keyword">if</span> (called) <span class="keyword">return</span>;</span><br><span class="line">            called = <span class="literal">true</span>;</span><br><span class="line">            resolvePromise(promise, y, resolve, reject);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// å¦‚æœ rejectPromise ä»¥æ®å›  r ä¸ºå‚æ•°è¢«è°ƒç”¨ï¼Œåˆ™ä»¥æ®å›  r æ‹’ç» promise</span></span><br><span class="line">          <span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (called) <span class="keyword">return</span>;</span><br><span class="line">            called = <span class="literal">true</span>;</span><br><span class="line">            reject(r);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœè°ƒç”¨ then æ–¹æ³•æŠ›å‡ºäº†å¼‚å¸¸ errorï¼š</span></span><br><span class="line">        <span class="comment">// å¦‚æœ resolvePromise æˆ– rejectPromise å·²ç»è¢«è°ƒç”¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (called) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦åˆ™ä»¥ error ä¸ºæ®å› æ‹’ç» promise</span></span><br><span class="line">        reject(error);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœ then ä¸æ˜¯å‡½æ•°ï¼Œä»¥ x ä¸ºå‚æ•°æ‰§è¡Œ promise</span></span><br><span class="line">      resolve(x);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœ x ä¸ä¸ºå¯¹è±¡æˆ–è€…å‡½æ•°ï¼Œä»¥ x ä¸ºå‚æ•°æ‰§è¡Œ promise</span></span><br><span class="line">    resolve(x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šå„¿å’±ä»¬å†æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<p>é¦–å…ˆä¸‹è½½æµ‹è¯•åŒ…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install promises-aplus-tests -D</span><br></pre></td></tr></table></figure>

<p>ç„¶åä¿®æ”¹ä»£ç ï¼ŒåŠ å…¥ deferred</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise.js</span></span><br><span class="line"></span><br><span class="line">MyPromise &#123;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyPromise.deferred = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = &#123;&#125;;</span><br><span class="line">  result.promise = <span class="keyword">new</span> MyPromise(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    result.resolve = resolve;</span><br><span class="line">    result.reject = reject;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = MyPromise;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨package.jsoné‡Œé…ç½®å‘½ä»¤ï¼Œè®°å¾—è¦æŠŠMypromise.jsæ”¾åœ¨æ ¹ç›®å½•ä¸‹</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;promises-aplus-tests MyPromise&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥è¿è¡Œæµ‹è¯•äº†</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹ï¼Œ872é¡¹æµ‹è¯•å‡é€šè¿‡</p>
<img data-src="https://gitee.com/monkey-HH/picBed/raw/master/picbed/img/202111161312705.png" alt="image-20211116131251628" style="zoom: 67%;" />



<h2 id="5-2-å®ç°Promiseçš„-resolveã€reject-å’Œ-finally"><a href="#5-2-å®ç°Promiseçš„-resolveã€reject-å’Œ-finally" class="headerlink" title="5.2 å®ç°Promiseçš„ resolveã€reject å’Œ finally"></a>5.2 å®ç°Promiseçš„ resolveã€reject å’Œ finally</h2><h3 id="å®ç°-Promise-resolve"><a href="#å®ç°-Promise-resolve" class="headerlink" title="å®ç° Promise.resolve"></a>å®ç° Promise.resolve</h3><p>å®ç° resolve é™æ€æ–¹æ³•æœ‰ä¸‰ä¸ªè¦ç‚¹:</p>
<ul>
<li>ä¼ å‚ä¸ºä¸€ä¸ª Promise, åˆ™ç›´æ¥è¿”å›å®ƒã€‚</li>
<li>ä¼ å‚ä¸ºä¸€ä¸ª thenable å¯¹è±¡ï¼Œè¿”å›çš„ Promise ä¼šè·Ÿéšè¿™ä¸ªå¯¹è±¡ï¼Œ<code>é‡‡ç”¨å®ƒçš„æœ€ç»ˆçŠ¶æ€</code>ä½œä¸º<code>è‡ªå·±çš„çŠ¶æ€</code>ã€‚</li>
<li>å…¶ä»–æƒ…å†µï¼Œç›´æ¥è¿”å›ä»¥è¯¥å€¼ä¸ºæˆåŠŸçŠ¶æ€çš„promiseå¯¹è±¡ã€‚</li>
</ul>
<p>å…·ä½“å®ç°å¦‚ä¸‹:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve = <span class="function">(<span class="params">param</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(param <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) <span class="keyword">return</span> param;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(param &amp;&amp; param.then &amp;&amp; <span class="keyword">typeof</span> param.then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// param çŠ¶æ€å˜ä¸ºæˆåŠŸä¼šè°ƒç”¨resolveï¼Œå°†æ–° Promise çš„çŠ¶æ€å˜ä¸ºæˆåŠŸï¼Œåä¹‹äº¦ç„¶</span></span><br><span class="line">      param.then(resolve, reject);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      resolve(param);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å®ç°-Promise-reject"><a href="#å®ç°-Promise-reject" class="headerlink" title="å®ç° Promise.reject"></a>å®ç° Promise.reject</h3><p>Promise.reject ä¸­ä¼ å…¥çš„å‚æ•°ä¼šä½œä¸ºä¸€ä¸ª reason åŸå°ä¸åŠ¨åœ°å¾€ä¸‹ä¼ , å®ç°å¦‚ä¸‹:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.reject = <span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        reject(reason);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å®ç°-Promise-prototype-finally"><a href="#å®ç°-Promise-prototype-finally" class="headerlink" title="å®ç° Promise.prototype.finally"></a>å®ç° Promise.prototype.finally</h3><p>æ— è®ºå½“å‰ Promise æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œè°ƒç”¨<code>finally</code>ä¹‹åéƒ½ä¼šæ‰§è¡Œ finally ä¸­ä¼ å…¥çš„å‡½æ•°ï¼Œå¹¶ä¸”å°†å€¼åŸå°ä¸åŠ¨çš„å¾€ä¸‹ä¼ ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.prototype.finally = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(callback()).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(callback()).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h2 id="5-3-å®ç°Promiseçš„-all-å’Œ-race"><a href="#5-3-å®ç°Promiseçš„-all-å’Œ-race" class="headerlink" title="5.3 å®ç°Promiseçš„ all å’Œ race"></a>5.3 å®ç°Promiseçš„ all å’Œ race</h2><h3 id="å®ç°-Promise-all"><a href="#å®ç°-Promise-all" class="headerlink" title="å®ç° Promise.all"></a>å®ç° Promise.all</h3><p>å¯¹äº all æ–¹æ³•è€Œè¨€ï¼Œéœ€è¦å®Œæˆä¸‹é¢çš„æ ¸å¿ƒåŠŸèƒ½:</p>
<ol>
<li>ä¼ å…¥å‚æ•°ä¸ºä¸€ä¸ªç©ºçš„å¯è¿­ä»£å¯¹è±¡ï¼Œåˆ™<code>ç›´æ¥è¿›è¡Œresolve</code>ã€‚</li>
<li>å¦‚æœå‚æ•°ä¸­<code>æœ‰ä¸€ä¸ª</code>promiseå¤±è´¥ï¼Œé‚£ä¹ˆPromise.allè¿”å›çš„promiseå¯¹è±¡å¤±è´¥ã€‚</li>
<li>åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ŒPromise.all è¿”å›çš„ promise çš„å®ŒæˆçŠ¶æ€çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ª<code>æ•°ç»„</code></li>
</ol>
<p>å…·ä½“å®ç°å¦‚ä¸‹:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.all = <span class="function"><span class="keyword">function</span>(<span class="params">promises</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> result = [];</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> len = promises.length;</span><br><span class="line">    <span class="keyword">if</span>(len === <span class="number">0</span>) &#123;</span><br><span class="line">      resolve(result);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="comment">// ä¸ºä»€ä¹ˆä¸ç›´æ¥ promise[i].then, å› ä¸ºpromise[i]å¯èƒ½ä¸æ˜¯ä¸€ä¸ªpromise</span></span><br><span class="line">      <span class="built_in">Promise</span>.resolve(promise[i]).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        result[i] = data;</span><br><span class="line">        index++;</span><br><span class="line">        <span class="keyword">if</span>(index === len) resolve(result);</span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        reject(err);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<h3 id="å®ç°-Promise-race"><a href="#å®ç°-Promise-race" class="headerlink" title="å®ç° Promise.race"></a>å®ç° Promise.race</h3><p>race çš„å®ç°ç›¸æ¯”ä¹‹ä¸‹å°±ç®€å•ä¸€äº›ï¼Œåªè¦æœ‰ä¸€ä¸ª promise æ‰§è¡Œå®Œï¼Œç›´æ¥ resolve å¹¶åœæ­¢æ‰§è¡Œã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.race = <span class="function"><span class="keyword">function</span>(<span class="params">promises</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> len = promises.length;</span><br><span class="line">    <span class="keyword">if</span>(len === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="built_in">Promise</span>.resolve(promise[i]).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        resolve(data);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        reject(err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œä¸€ä¸ªå®Œæ•´çš„ Promise å°±è¢«æˆ‘ä»¬å®ç°å®Œå•¦ã€‚ä»åŸç†åˆ°ç»†èŠ‚ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥æ‹†è§£å’Œå®ç°ï¼Œå¸Œæœ›å¤§å®¶åœ¨çŸ¥é“ Promise è®¾è®¡ä¸Šçš„å‡ å¤§äº®ç‚¹ä¹‹åï¼Œä¹Ÿèƒ½è‡ªå·±æ‰‹åŠ¨å®ç°ä¸€ä¸ªPromiseï¼Œè®©è‡ªå·±çš„æ€ç»´å±‚æ¬¡å’ŒåŠ¨æ‰‹èƒ½åŠ›æ›´ä¸Šä¸€å±‚æ¥¼ï¼</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><span class="exturl" data-url="aHR0cHM6Ly93YW5nZG9jLmNvbS9lczYvcHJvbWlzZS5odG1s">Promise å¯¹è±¡</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTAzNjI1NzY5MDkxMDc5">BATå‰ç«¯ç»å…¸é¢è¯•é—®é¢˜ï¼šå²ä¸Šæœ€æœ€æœ€è¯¦ç»†çš„æ‰‹å†™Promiseæ•™ç¨‹</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTA0MDA0MDA3MjQ3ODgw">åŸç”ŸJSçµé­‚ä¹‹é—®(ä¸‹), å†²åˆºğŸš€è¿›é˜¶æœ€åä¸€å…¬é‡Œ</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82OTQ1MzE5NDM5NzcyNDM0NDY5I2hlYWRpbmctMw==">ä»ä¸€é“è®©æˆ‘å¤±çœ çš„ Promise é¢è¯•é¢˜å¼€å§‹ï¼Œæ·±å…¥åˆ†æ Promise å®ç°ç»†èŠ‚</span></li>
</ol>

      <div class="tags">
          <a href="/tags/JavaScript/" rel="tag"><i class="ic i-tag"></i> JavaScript</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2021-12-28 10:19:47" itemprop="dateModified" datetime="2021-12-28T10:19:47+08:00">2021-12-28</time>
  </span>
  <span id="FrontEnd/JavaScript/FrontEnd/JavaScript/ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘Promiseä»‹ç»ä»¥åŠå®ç°ä¸€ä¸ªPromise" class="item leancloud_visitors" data-flag-title="ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘Promiseä»‹ç»ä»¥åŠå®ç°ä¸€ä¸ªPromise" title="Views">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">Views</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">times</span>
  </span>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>Monkey-HH <i class="ic i-at"><em>@</em></i>
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="https://monkeyhh.top/FrontEnd/JavaScript/FrontEnd/JavaScript/%E3%80%90%E6%89%8B%E6%92%95JavaScript%E7%B3%BB%E5%88%97%E3%80%91Promise%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAPromise" title="ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘Promiseä»‹ç»ä»¥åŠå®ç°ä¸€ä¸ªPromise">https://monkeyhh.top/FrontEnd/JavaScript/FrontEnd/JavaScript/ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘Promiseä»‹ç»ä»¥åŠå®ç°ä¸€ä¸ªPromise</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/%E3%80%90%E6%89%8B%E6%92%95JavaScript%E7%B3%BB%E5%88%97%E3%80%91this%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%8B%9F%E5%AE%9E%E7%8E%B0call%E3%80%81bind%E3%80%81apply" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;monkey-HH&#x2F;picBed&#x2F;raw&#x2F;master&#x2F;picbed&#x2F;img&#x2F;202109201019726.png" title="ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘thisåŸç†ä»¥åŠæ¨¡æ‹Ÿå®ç°callã€bindã€apply">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> JavaScript</span>
  <h3>ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘thisåŸç†ä»¥åŠæ¨¡æ‹Ÿå®ç°callã€bindã€apply</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/FrontEnd/Browser/FrontEnd/Browser/%E3%80%90V8%E5%BC%95%E6%93%8E%E5%8E%9F%E7%90%86%E7%AF%87%E3%80%91Event%20Loop%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E6%9C%BA%E5%88%B6" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;monkey-HH&#x2F;picBed&#x2F;raw&#x2F;master&#x2F;picbed&#x2F;img&#x2F;202109201018875.jpg" title="ã€V8å¼•æ“åŸç†ç¯‡ã€‘Event Loopäº‹ä»¶å¾ªç¯æœºåˆ¶">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> Browser</span>
  <h3>ã€V8å¼•æ“åŸç†ç¯‡ã€‘Event Loopäº‹ä»¶å¾ªç¯æœºåˆ¶</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Promise%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">1.Promiseæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Promise%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">2. Promiseçš„ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E4%B8%80%E4%B8%AA%E5%B0%8F%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.</span> <span class="toc-text">3. ä¸€ä¸ªå°ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Promise%E5%B8%B8%E7%94%A8API"><span class="toc-number">4.</span> <span class="toc-text">4.Promiseå¸¸ç”¨API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Promise-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-Promise-executor"><span class="toc-number">4.0.1.</span> <span class="toc-text">1. Promise æ„é€ å‡½æ•°: Promise (executor) {}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Promise-prototype-then-%E6%96%B9%E6%B3%95-onResolved-onRejected-gt"><span class="toc-number">4.0.2.</span> <span class="toc-text">2. Promise.prototype.then æ–¹æ³•: (onResolved, onRejected) &#x3D;&gt; {}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Promise-prototype-catch-%E6%96%B9%E6%B3%95%EF%BC%9A-onRejected-gt"><span class="toc-number">4.0.3.</span> <span class="toc-text">3.Promise.prototype.catch()æ–¹æ³•ï¼š (onRejected) &#x3D;&gt; {}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Promise-prototype-finally"><span class="toc-number">4.0.4.</span> <span class="toc-text">4. Promise.prototype.finally()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Promise-resolve-value-%E8%AF%A6%E8%A7%A3"><span class="toc-number">4.0.5.</span> <span class="toc-text">5.Promise.resolve(value)è¯¦è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Promise-reject-reason-%E8%AF%A6%E8%A7%A3"><span class="toc-number">4.0.6.</span> <span class="toc-text">6.Promise.reject(reason)è¯¦è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-Promise-all"><span class="toc-number">4.0.7.</span> <span class="toc-text">7.Promise.all()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-Promise-race"><span class="toc-number">4.0.8.</span> <span class="toc-text">8.Promise.race()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-Promise-allSettled"><span class="toc-number">4.0.9.</span> <span class="toc-text">9.Promise.allSettled()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-Promise-any"><span class="toc-number">4.0.10.</span> <span class="toc-text">10.Promise.any()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%89%8B%E6%92%95Promise%E7%B3%BB%E5%88%97"><span class="toc-number">5.</span> <span class="toc-text">5. æ‰‹æ’•Promiseç³»åˆ—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 é¢„å¤‡çŸ¥è¯†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E6%89%8B%E6%92%95Promise"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 æ‰‹æ’•Promise</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-%E7%AC%AC%E4%B8%80%E7%89%88%EF%BC%9A%E7%AE%80%E5%8D%95%E6%A1%86%E6%9E%B6"><span class="toc-number">5.2.1.</span> <span class="toc-text">5.2.1 ç¬¬ä¸€ç‰ˆï¼šç®€å•æ¡†æ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-%E7%AC%AC%E4%BA%8C%E7%89%88%EF%BC%9A%E5%8A%A0%E5%85%A5%E5%BC%82%E6%AD%A5%E9%80%BB%E8%BE%91"><span class="toc-number">5.2.2.</span> <span class="toc-text">5.2.2 ç¬¬äºŒç‰ˆï¼šåŠ å…¥å¼‚æ­¥é€»è¾‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-%E7%AC%AC%E4%B8%89%E7%89%88%EF%BC%9A%E5%AE%9E%E7%8E%B0then%E6%96%B9%E6%B3%95%E5%A4%9A%E6%AC%A1%E8%B0%83%E7%94%A8"><span class="toc-number">5.2.3.</span> <span class="toc-text">5.2.3 ç¬¬ä¸‰ç‰ˆï¼šå®ç°thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-4-%E7%AC%AC%E5%9B%9B%E7%89%88%EF%BC%9A%E5%AE%9E%E7%8E%B0then%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8"><span class="toc-number">5.2.4.</span> <span class="toc-text">5.2.4 ç¬¬å››ç‰ˆï¼šå®ç°thené“¾å¼è°ƒç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-5-%E7%AC%AC%E4%BA%94%E7%89%88%EF%BC%9A%E5%AE%9E%E7%8E%B0then%E5%8F%82%E6%95%B0%E9%BB%98%E8%AE%A4%E5%87%BD%E6%95%B0%E3%80%81catch%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.5.</span> <span class="toc-text">5.2.5 ç¬¬äº”ç‰ˆï¼šå®ç°thenå‚æ•°é»˜è®¤å‡½æ•°ã€catchæ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-6-%E7%AC%AC%E5%85%AD%E7%89%88%EF%BC%9A%E8%A7%84%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">5.2.6.</span> <span class="toc-text">5.2.6 ç¬¬å…­ç‰ˆï¼šè§„æ•´ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-7-%E7%AC%AC%E4%B8%83%E7%89%88%EF%BC%9A%E7%AC%A6%E5%90%88A-%E8%A7%84%E8%8C%83%E7%89%88%E6%9C%AC"><span class="toc-number">5.2.7.</span> <span class="toc-text">5.2.7  ç¬¬ä¸ƒç‰ˆï¼šç¬¦åˆA+è§„èŒƒç‰ˆæœ¬</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E5%AE%9E%E7%8E%B0Promise%E7%9A%84-resolve%E3%80%81reject-%E5%92%8C-finally"><span class="toc-number">5.3.</span> <span class="toc-text">5.2 å®ç°Promiseçš„ resolveã€reject å’Œ finally</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-Promise-resolve"><span class="toc-number">5.3.1.</span> <span class="toc-text">å®ç° Promise.resolve</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-Promise-reject"><span class="toc-number">5.3.2.</span> <span class="toc-text">å®ç° Promise.reject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-Promise-prototype-finally"><span class="toc-number">5.3.3.</span> <span class="toc-text">å®ç° Promise.prototype.finally</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E5%AE%9E%E7%8E%B0Promise%E7%9A%84-all-%E5%92%8C-race"><span class="toc-number">5.4.</span> <span class="toc-text">5.3 å®ç°Promiseçš„ all å’Œ race</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-Promise-all"><span class="toc-number">5.4.1.</span> <span class="toc-text">å®ç° Promise.all</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-Promise-race"><span class="toc-number">5.4.2.</span> <span class="toc-text">å®ç° Promise.race</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
        <ul>
          <li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/jQuery%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%85%A5%E9%97%A8" rel="bookmark" title="jQueryåŸºç¡€çŸ¥è¯†å…¥é—¨">jQueryåŸºç¡€çŸ¥è¯†å…¥é—¨</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%B8%8E%E9%97%AD%E5%8C%85" rel="bookmark" title="JavaScriptä½œç”¨åŸŸä¸é—­åŒ…">JavaScriptä½œç”¨åŸŸä¸é—­åŒ…</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B" rel="bookmark" title="JavaScriptä¸­çš„å˜é‡ç±»å‹">JavaScriptä¸­çš„å˜é‡ç±»å‹</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E4%B8%AD%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B%EF%BC%88BOM%EF%BC%89" rel="bookmark" title="JavaScriptä¸­çš„æµè§ˆå™¨å¯¹è±¡æ¨¡å‹ï¼ˆBOMï¼‰">JavaScriptä¸­çš„æµè§ˆå™¨å¯¹è±¡æ¨¡å‹ï¼ˆBOMï¼‰</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E5%8E%9F%E5%BD%A2%E4%B8%8E%E5%8E%9F%E5%9E%8B%E9%93%BE" rel="bookmark" title="JavaScriptåŸå‹ä¸åŸå‹é“¾">JavaScriptåŸå‹ä¸åŸå‹é“¾</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E4%BA%8B%E4%BB%B6" rel="bookmark" title="JavaScriptäº‹ä»¶">JavaScriptäº‹ä»¶</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E4%B8%ADDOM%E6%93%8D%E4%BD%9C%E6%80%BB%E7%BB%93" rel="bookmark" title="JavaScriptä¸­DOMæ“ä½œæ€»ç»“">JavaScriptä¸­DOMæ“ä½œæ€»ç»“</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E4%B8%AD%E7%9A%84%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96" rel="bookmark" title="JavaScriptä¸­çš„å‰ç«¯æ¨¡å—åŒ–">JavaScriptä¸­çš„å‰ç«¯æ¨¡å—åŒ–</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87" rel="bookmark" title="JavaScriptæ‰§è¡Œä¸Šä¸‹æ–‡">JavaScriptæ‰§è¡Œä¸Šä¸‹æ–‡</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E5%B8%B8%E7%94%A8%E7%BB%A7%E6%89%BF%E6%96%B9%E6%A1%88" rel="bookmark" title="JavaScriptå¸¸ç”¨ç»§æ‰¿æ–¹æ¡ˆ">JavaScriptå¸¸ç”¨ç»§æ‰¿æ–¹æ¡ˆ</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/%E3%80%90%E6%89%8B%E6%92%95JavaScript%E7%B3%BB%E5%88%97%E3%80%91JavaScript%E4%B8%AD%E7%9A%84%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D" rel="bookmark" title="ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘JavaScriptä¸­çš„æµ…æ‹·è´å’Œæ·±æ‹·è´">ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘JavaScriptä¸­çš„æµ…æ‹·è´å’Œæ·±æ‹·è´</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/axios%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%82%B9%E5%85%A5%E9%97%A8" rel="bookmark" title="axiosåŸºç¡€çŸ¥è¯†ç‚¹å…¥é—¨">axiosåŸºç¡€çŸ¥è¯†ç‚¹å…¥é—¨</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/%E3%80%90%E6%89%8B%E6%92%95JavaScript%E7%B3%BB%E5%88%97%E3%80%91this%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%8B%9F%E5%AE%9E%E7%8E%B0call%E3%80%81bind%E3%80%81apply" rel="bookmark" title="ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘thisåŸç†ä»¥åŠæ¨¡æ‹Ÿå®ç°callã€bindã€apply">ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘thisåŸç†ä»¥åŠæ¨¡æ‹Ÿå®ç°callã€bindã€apply</a></li><li class="active"><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/%E3%80%90%E6%89%8B%E6%92%95JavaScript%E7%B3%BB%E5%88%97%E3%80%91Promise%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAPromise" rel="bookmark" title="ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘Promiseä»‹ç»ä»¥åŠå®ç°ä¸€ä¸ªPromise">ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘Promiseä»‹ç»ä»¥åŠå®ç°ä¸€ä¸ªPromise</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/%E3%80%90%E6%89%8B%E6%92%95JavaScript%E7%B3%BB%E5%88%97%E3%80%91JavaScript%E4%B8%AD%E7%9A%84%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81" rel="bookmark" title="ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘JavaScriptä¸­çš„é˜²æŠ–ä¸èŠ‚æµ">ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘JavaScriptä¸­çš„é˜²æŠ–ä¸èŠ‚æµ</a></li><li><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E4%B8%AD%E7%9A%84%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E6%96%B9%E6%A1%88" rel="bookmark" title="JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆ">JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆ</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="Monkey-HH"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">Monkey-HH</p>
  <div class="description" itemprop="description">Learn, share, make progress</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">54</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">18</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">23</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL21vbmtleS1ISA==" title="https:&#x2F;&#x2F;github.com&#x2F;monkey-HH"><i class="ic i-github"></i></span>
      <span class="exturl item email" data-url="bWFpbHRvOmhoanNjYXVAMTYzLmNvbQ==" title="mailto:hhjscau@163.com"><i class="ic i-envelope"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>Friends</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>About</a>
  </li>

    
  <li class="item">
    <a href="/links/" rel="section"><i class="ic i-magic"></i>Links</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/%E3%80%90%E6%89%8B%E6%92%95JavaScript%E7%B3%BB%E5%88%97%E3%80%91this%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%8B%9F%E5%AE%9E%E7%8E%B0call%E3%80%81bind%E3%80%81apply" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/FrontEnd/Browser/FrontEnd/Browser/%E3%80%90V8%E5%BC%95%E6%93%8E%E5%8E%9F%E7%90%86%E7%AF%87%E3%80%91Event%20Loop%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E6%9C%BA%E5%88%B6" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/FrontEnd/" title="In FrontEnd">FrontEnd</a>
<i class="ic i-angle-right"></i>
<a href="/categories/FrontEnd/Browser/" title="In Browser">Browser</a>
</div>

    <span><a href="/FrontEnd/Browser/FrontEnd/Browser/%E3%80%90V8%E5%BC%95%E6%93%8E%E5%8E%9F%E7%90%86%E7%AF%87%E3%80%91JavaScript%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E6%9C%BA%E5%88%B6" title="ã€V8å¼•æ“åŸç†ç¯‡ã€‘JavaScriptäº‹ä»¶å¾ªç¯æœºåˆ¶">ã€V8å¼•æ“åŸç†ç¯‡ã€‘JavaScriptäº‹ä»¶å¾ªç¯æœºåˆ¶</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/FrontEnd/" title="In FrontEnd">FrontEnd</a>
<i class="ic i-angle-right"></i>
<a href="/categories/FrontEnd/React/" title="In React">React</a>
</div>

    <span><a href="/FrontEnd/React/FrontEnd/React/%E3%80%90React%E5%9F%BA%E7%A1%80%E3%80%91Virtual%20DOM%E4%B8%8EDiff%E7%AE%97%E6%B3%95%E5%88%9D%E8%AF%86" title="ã€ReactåŸºç¡€ã€‘Virtual DOMä¸Diffç®—æ³•åˆè¯†">ã€ReactåŸºç¡€ã€‘Virtual DOMä¸Diffç®—æ³•åˆè¯†</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/FrontEnd/" title="In FrontEnd">FrontEnd</a>
<i class="ic i-angle-right"></i>
<a href="/categories/FrontEnd/Browser/" title="In Browser">Browser</a>
</div>

    <span><a href="/FrontEnd/Browser/FrontEnd/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AD%98%E5%82%A8" title="æµè§ˆå™¨ä¸­çš„å®¢æˆ·ç«¯å­˜å‚¨">æµè§ˆå™¨ä¸­çš„å®¢æˆ·ç«¯å­˜å‚¨</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/FrontEnd/" title="In FrontEnd">FrontEnd</a>
<i class="ic i-angle-right"></i>
<a href="/categories/FrontEnd/JavaScript/" title="In JavaScript">JavaScript</a>
</div>

    <span><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E4%B8%AD%E7%9A%84%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96" title="JavaScriptä¸­çš„å‰ç«¯æ¨¡å—åŒ–">JavaScriptä¸­çš„å‰ç«¯æ¨¡å—åŒ–</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/FrontEnd/" title="In FrontEnd">FrontEnd</a>
<i class="ic i-angle-right"></i>
<a href="/categories/FrontEnd/Vue/" title="In Vue">Vue</a>
</div>

    <span><a href="/FrontEnd/Vue/FrontEnd/Vue/%E3%80%90Vue%E8%BF%9B%E9%98%B6%E3%80%91%E6%B5%85%E8%B0%88Vue2%E4%B8%8EVue3%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86" title="ã€Vueè¿›é˜¶ã€‘æµ…è°ˆVue2ä¸Vue3å“åº”å¼åŸç†">ã€Vueè¿›é˜¶ã€‘æµ…è°ˆVue2ä¸Vue3å“åº”å¼åŸç†</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/FrontEnd/" title="In FrontEnd">FrontEnd</a>
<i class="ic i-angle-right"></i>
<a href="/categories/FrontEnd/Browser/" title="In Browser">Browser</a>
</div>

    <span><a href="/FrontEnd/Browser/FrontEnd/Browser/%E3%80%90V8%E5%BC%95%E6%93%8E%E5%8E%9F%E7%90%86%E7%AF%87%E3%80%91Event%20Loop%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E6%9C%BA%E5%88%B6" title="ã€V8å¼•æ“åŸç†ç¯‡ã€‘Event Loopäº‹ä»¶å¾ªç¯æœºåˆ¶">ã€V8å¼•æ“åŸç†ç¯‡ã€‘Event Loopäº‹ä»¶å¾ªç¯æœºåˆ¶</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/FrontEnd/" title="In FrontEnd">FrontEnd</a>
<i class="ic i-angle-right"></i>
<a href="/categories/FrontEnd/Browser/" title="In Browser">Browser</a>
</div>

    <span><a href="/FrontEnd/Browser/FrontEnd/Browser/%E3%80%90V8%E5%BC%95%E6%93%8E%E5%8E%9F%E7%90%86%E7%AF%87%E3%80%91V8%E7%9A%84%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%E5%8F%8A%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E5%88%86%E6%9E%90" title="ã€V8å¼•æ“åŸç†ç¯‡ã€‘V8çš„å†…å­˜ç®¡ç†ä¸åƒåœ¾å›æ”¶æœºåˆ¶åŠå†…å­˜æ³„æ¼åˆ†æ">ã€V8å¼•æ“åŸç†ç¯‡ã€‘V8çš„å†…å­˜ç®¡ç†ä¸åƒåœ¾å›æ”¶æœºåˆ¶åŠå†…å­˜æ³„æ¼åˆ†æ</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/FrontEnd/" title="In FrontEnd">FrontEnd</a>
<i class="ic i-angle-right"></i>
<a href="/categories/FrontEnd/JavaScript/" title="In JavaScript">JavaScript</a>
</div>

    <span><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/%E3%80%90%E6%89%8B%E6%92%95JavaScript%E7%B3%BB%E5%88%97%E3%80%91JavaScript%E4%B8%AD%E7%9A%84%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D" title="ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘JavaScriptä¸­çš„æµ…æ‹·è´å’Œæ·±æ‹·è´">ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘JavaScriptä¸­çš„æµ…æ‹·è´å’Œæ·±æ‹·è´</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/FrontEnd/" title="In FrontEnd">FrontEnd</a>
<i class="ic i-angle-right"></i>
<a href="/categories/FrontEnd/JavaScript/" title="In JavaScript">JavaScript</a>
</div>

    <span><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/JavaScript%E4%B8%ADDOM%E6%93%8D%E4%BD%9C%E6%80%BB%E7%BB%93" title="JavaScriptä¸­DOMæ“ä½œæ€»ç»“">JavaScriptä¸­DOMæ“ä½œæ€»ç»“</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/FrontEnd/" title="In FrontEnd">FrontEnd</a>
<i class="ic i-angle-right"></i>
<a href="/categories/FrontEnd/JavaScript/" title="In JavaScript">JavaScript</a>
</div>

    <span><a href="/FrontEnd/JavaScript/FrontEnd/JavaScript/axios%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%82%B9%E5%85%A5%E9%97%A8" title="axiosåŸºç¡€çŸ¥è¯†ç‚¹å…¥é—¨">axiosåŸºç¡€çŸ¥è¯†ç‚¹å…¥é—¨</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2021 â€“ 
    <span itemprop="copyrightYear">2022</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Monkey-HH @ Monkey's Blog</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="Symbols count total">774k words</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="Reading time total">11:43</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: 'FrontEnd/JavaScript/FrontEnd/JavaScript/ã€æ‰‹æ’•JavaScriptç³»åˆ—ã€‘Promiseä»‹ç»ä»¥åŠå®ç°ä¸€ä¸ªPromise',
    favicon: {
      show: "ï¼ˆâ—Â´3ï½€â—ï¼‰Goooood",
      hide: "(Â´Ğ”ï½€)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
